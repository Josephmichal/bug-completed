## Introduction
-->This course details the exploitation of an insecure OAuth2 Authorization Server that allows a malicious user to trick a victim to gain access to his/her account.
-->OAuth2 is incredibly hard to get right that's why being able to find holes in implementations is so important.

## The vulnerability
-->This vulnerability here is a simple Cross-Site Request Forgery vulnerability in the Authorization Server. The page used by users to Authorise an application doesn't check the CSRF token provided as part of the POST request.
-->When a user authorises an application, two steps happen:
1.  The user visits a page with details on the application and the scope of the authorization.
2.  The user authorises the application.

-->The second step is done via a POST request and should be protected against CSRF.

## Exploitation
-->To exploit this vulnerability, you will need to register an account and create an OAuth application. Make sure you set the redirect URL to your server and save the client ID and secret.
-->By clicking on the Authorize button, you should get access to the form used to authorise the application.
-->Once you setup your webserver with the malicious page that automatically sends the POST request to authorise the application (by using an auto-submitting form), you need to get the victim to visit your web server.
-->After visiting the malicious page, the victim should be redirected back to your page (thanks to the redirect URI) and you should get a code. You can use this code along with your secret and client id to get a token. For example, if you use Ruby and the gem oauth2, the following code allows you to get a token:
```
	require 'oauth2'
	 
	callback = "[CALLBACK_URL]"
	app_id = "[APPLICATION_ID]"
	 
	secret = "[SECRET]"
	client = OAuth2::Client.new(app_id, secret, site: "[AUTHORIZATION_SERVER]")
	client.auth_code.authorize_url(redirect_uri: callback)
	 
	 
	code="[CODE]"
	access = client.auth_code.get_token( code, redirect_uri: callback)
	access.get("/api/user").parsed
	 
	puts access.token 
```
-->Finally, you can use the token to access the resource server and get the key for this challenge using the following curl command:
```bash
curl -H 'Authorization: Bearer [TOKEN]' [RESOURCE_SERVER]/api/keys --dump-header -
```
-->If the victim authorises your application, you need to be quick to get and use the code and token. If you wait too long, you may need to restart from scratch with a new application.

## Conclusion
-->This exercise showed you how to exploit a vulnerability in an OAuth2 implementation impacting the Authorization Server. With more and more enterprises using OAuth2, it's important to ensure that this kind of mistakes gets detected and fixed before they get exploited.

# Video Explanation
## Video 1 - introduction

- Register an OAuth2 client
- Create a malicious page that sends the POST reqeust automatically to authorise our client
- Get the victim to vist your malicious page
- Get the code
- Exchange the code for a token
- Use the token to get access to the key for this challenge

## Video 2 exploitation
-->ee lab il ivan enthokeyo kanikunund.but karyangal oke manasilakunund ie, auth server il namal signup chyumbol authorise chyano enn namalod service chodikum apol namal authorize click chythal namal aa service il ninum account undakum like google gmail
-->so ignane authorize click chyunathin mumb aa authorise button inspect element adichit nokumbol form il hidden value kidakunath kanam like csrf.so aa value remove chyth authorize click chyumbozhum namuk account undakan patunund
-->which menas oauth il csrf protection illa ennartham.so ee form namal copy chyth namal oru malicius html file aakuka.enit namal ngork polula ethengilum site il poi oru auth service aaknaamen thonunu.enit ee site victim kodukuka.victim ee malicious autheservice il pokumbol victim inte hidden value namuk kitum angane namuk victim aayi maran patumen thonunu
-->o ithinayi namal oru oauthe application unakanam.enit namude theory part il ulla ruby script il ithil ninum kituna secret um matumoke copy chyth script il idanam.enit aa script oru ruby file il akanam enit ruby command vech run chyanam apol namuk oru url kitum.so aa url copy chyth browser il itt send adichal namuk nerthe kitiya pole oauth2 verification popup kitum
-->ini ee oauth2 form agnage thane ispect element il ninum copy chyth namal oru html file il aakuka enit athil chela matangal veruthi chyuka enit namude website il ee html add chyikuka.ini victim ee page il verumbol victim inte secret hidden value namuk kitum ok
-->html file aakunath njan ivide kodukunila pakaram screen shot aaki pentesterlab file il save chythitunudn ok