## Introduction
-->This exercise covers how to gain access to an administration interface using SQL injection followed by how to get command execution using Ghostscript
-->This course details the exploitation of a SQL injection in a web application and how an attacker can use it to gain access to the administration pages. Then, using this access, the attacker will be able to gain code execution on the server using a vulnerability in an old version of Ghostscript.
-->The attack is divided into 3 steps:
1.  Find the SQL Injection to retrieve users' password and crack them
2.  Gain code execution
  
## The SQL Injection
-->When you visit the main page, the application allows you to filter the files based on the `user_id` using the following URL: `?filter[user_id]=1` for example. Here the vulnerability is located in the key (`user_id`) instead of in the value (`1`). The developer trusts the key and integrates it in the SQL query without any escaping. Then the application properly uses prepared-statement to add the value. You should be able to exploit this issue using a simple `UNION SELECT` exploitation like you saw in the [From SQL injection to Shell: PostgreSQL edition](https://pentesterlab.com/exercises/from_sqli_to_shell_pg_edition/) exercise. The only issue you may run into is that `null, null,...` will not work as some of the values are used in links in the page. Therefore, you will most likely need to ensure some of the values are not `null` to avoid breaking during the page's rendering by the server.
-->This vulnerability should allow you to retrieve the users' password hash.

## Gaining code execution/Ghostscript
-->Once you crack the password, you should have access to the management interface. In this interface, you can see a list of files and download them. If you upload a file, you should see that a prefix is added to the file's name and you have limited room to get code execution. Fortunately, you should be able to gain code execution using the resizing functionality.
-->The resizing functionality relies on a vulnerable version of Ghostscript (along with ImageMagick) and calls the tool `convert` (that will then run Ghostscript). The version used is vulnerable to the following [vulnerability](https://bugs.chromium.org/p/project-zero/issues/detail?id=1640) reported by Tavis Ormandy.
-->The exploitation relies on creating a malicious Postscript file containing the following malicious code (for example to run the command `COMMAND`):
```js
	%!PS
	userdict /setpagedevice undef
	save
	    legal
	    { null restore } stopped { pop } if
	    { legal } stopped { pop } if
	restore
	mark /OutputFile (%pipe%COMMAND) currentdevice putdeviceprops
```
-->More details on Ghostscript `%pipe` command can be found in this [Ruxcon talk from 2017](https://ruxcon.org.au/assets/2017/slides/hong-ps-and-gs-ruxcon2017.pdf).
-->However, the website only lets you upload `.jpg` and `.png` files. If you put the code above in a `.jpg` and `.png` the exploitation will still work as `convert` tries to guess the file type based on its content, not its extension.
-->You can find an example of the exploitation of this bug in bug bounty in this report: [H1514 Remote Code Execution on kitcrm using bulk customer update of Priority Products](https://hackerone.com/reports/422944).

## Conclusion
-->This exercise showed you how to manually detect and exploit SQL injection to gain access to users' password. Once the passwords are cracked, you get access to the management pages. In this "Trusted zone", more functionalities are available which may lead to more vulnerabilities. I hope you enjoyed learning with PentesterLab.

# Video Explanation
-->this challenge doesnot have any video explanation