## Introduction
-->This exercise details how to tamper with data encrypted using CBC
-->This course details the exploitation of a weakness in the authentication of a PHP website.
-->The website uses CBC to encrypt information provided by users and use this information to ensure authentication. We will see how this behaviour can impact the authentication and how it can be exploited.
-->If you want to do it by yourself, you can follow the following steps:
-   Create a user with a username similar to the desired username.
-   Modify the first bytes of the cookie to become the username you are trying to become.

## CBC (CIpher Block Chaining)
-->CBC is an encryption mode in which the message is split into blocks of X bytes length and each block is encrypted separately using a key.
-->The following schema (source: [Wikipedia](http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation)) explains this method:

![License](https://pentesterlab.com/cbc/CBC_encryption.png)

-->We are going to focus on the first block as with our current username, we only need one block. The schema below illustrates the decryption process with an arbitrary IV:
![CBC decryption basics](https://pentesterlab.com/cbc/cbc-1.png)

-->If you create a user `bdmin`, this is what you get during the decryption:![CBC decryption with bdmin](https://pentesterlab.com/cbc/cbc-2.png)
-->Now, we want to tamper with the IV (since it gets xored with the result of the decryption) to become `admin`:
![CBC decryption to become admin](https://pentesterlab.com/cbc/cbc-3.png)

## The attack
-->To perform this attack, you will need to automate it. To get started, create a simple script that sends your current cookie to the server and ensure you're still logged in.
-->Once you have that working, it's time to tamper with the IV.
-->Here, you will need to work out the block size. Based on the size of the cookie, it's very likely that the block size is 8 bytes. However, you can play with the size of the username to detect this (like we did in the [ECB exercise](https://pentesterlab.com/exercises/ecb/course)).
-->Once you have the block size, it's likely that the first block is the IV.
-->==Keep in mind that not all CBC implementation will give you access to the IV. In some cases, the IV will be hardcoded.==
-->After decoding the cookie, you can then extract the IV, and brute-force the byte (first byte of the IV if you used a username like `bdmin` or `xdmin`) you need to change until you become `admin`. In order to limit the amount of brute-force you will need, it's recommended to use a username like `bdmin` or `zdmin`. This will allow you to only have to tamper with the first byte to become `admin`.
-->You can also perform the same attack without using bruteforce by computing what the XOR between the first letter of the username you want and the first letter of the username you use and apply this (XOR) to the first byte of the IV.

## Conclusion
-->This exercise showed you how you can tamper encrypted information without decrypting them and use this behaviour to gain access to other accounts.
-->It showed you that encryption can not be used as a replacement to signature and how it's possible to use CBC encryption to get control on the decrypted information.

# Video Explanation
## Video 1 - CBC intordution
-->mumb namal ECB encryption mode ine patti padichirunu.athil oru block il 8 bytes aan undavuka.so namal same letters varuna 8 bytes usernmae or passwd oke undakiyal namuk athinte hex il ninum similar pattern kandupidich manasilkan kazhiyum ie, cookie namal kodutha same sttring pole similar pattern aanen
-->CBC yumb ekadhesham ECB pole aan. athayath oru byte encrypt chyum.but CBC yil kurach koodi security und ie, oru byte encrypt chyth aduthath encrypt chyymbol previous bytes nte encrypted value koodi edukum and XOR it with a clear text
-->so namal mumbathe encrypted value cherthan athine shesham ulla byte encrypt chyunath.athukond thane namal similar aaya string username or passwd in koduthalum ath anagne namuk manasilakila ok
-->CBC Inte encrytpion and decrytpion nokam (img form localsystyem ok)
![[CBC.png]]

-->But ivide aadyathe buyte in XOR illa.athayath oro byte encrypt chyumbozhum athinte mumbathe byte inte ecrypted value cherkumenale paranjath but aadyathe byten mumbil onum ilalo.so athinan "IV"  use chyunath(mukalil theory part il img und)
-->==By tamepering with the IV we can change the clear text and become administrator==
-->CBC yum ECB pole 8 bytes of block format aan.CBC yil aadyathe 8 bytes IV aayirikum


## Video - CBC Exploitation
-->aadyam ee CBC encryption nadakunath onukudi vyakthamayi nokam
```python
FROM YOUTBE (simple snippets):
-->namal kodukuna username, athini ethra lenth ullathayalum different blocks aayitan athine tharamthirikuka.ivide aa username(plaintext) ne 64 bit or 8 bytes aaki matum.ee oro 8 bytes um oru block aayi marum.
-->oro block ilum mumbathe block inte encrypted value undakum.athayath mumbath block il ninum undaya cipher text aan aduth block inte IV(Initialisation Vector).
-->ini IV enthanen nokam.ECB yil oro block ilem bytes encrypt chyunath independent aayitan.pine oro block um matu block umayi connection ila.so oru block angane thane remove chythal matu block in samshayam undakila.ennal CBC yil oro block intem koode matu block inte cipher text undakum.ee previous cipher text aan IV.ee cipher text koodi cherthan pthiya block ile plain text ine cipher text aaki matunath.
-->pakshe aadyathe block il mathrame IV undaku athayath randamathe block thott iv een parayilan thonunu just XOR matharame undaku 
-->aadyathe block in mumb vere onum illathath kondan IV introduce chythath.
-->so oru eg nokam.namal oru username koduthu->"cdmin" and ithine 8 bytes aaki.so aadythe 8 bytes il ee username(plain text) um pine athinte koode athe length(ie, 8 bytes) ulla oru random IV undakum.so ith randum koodi chernit eth AES use chyth (OR eth type encryption aanen vecha ath) key vech aadyathe cipher text undakunu.
-->enit enth chyunu ennal adutha block encrypt chyuna samayath ee aadyathe block il ninum undakiya cipher text koodi use chyunu angane encryption strong aakunu.athayath aadyathe block ile ciphertext um randamathe block ile ciphertext um mumb nadanapole oru mathmatical process vazhi encode chyunu.enit ath encrypt chyunu.so ingane chyunathkond thane oru block same aayirikila ok
-->IV yil ulla oro byte um plain text il ulla byte umayi encoding nadakunund.athin sheshaman encryption processilek pokunath.so namude first block ile palin text il cdmin enn undenkil aa c mati namuk a aakanam.athan namuk vendath.so IV yil ulla adyathe byte il namal change varuthanam.enit aa c kk corresponding aaya value mati a kk corresponding aaya hex number idanam ok apol cdmin enna username mati cookieyil admin enn namuk correct name koduth admin aayi impersonate chyan patu ok
```

-->namal cookie oke decoder il itt decode chynathin mumb cookie yil enthengilum url encoded characters undon nokanam.angane undengil base64 decode chyunathin mumb aadyam url decode chyanam enite base64 decode chyan padulu ok

-->so adyam lab open aakuka enit puthiya accoutn register chyuk
-->username : cdmin , passwd : test kodukuka
-->enit namal burp il poi nokiyal kanam namuk puthiya auth session cookie kiteetind
-->so ath eduth decoder il itt url-base64 decode chyuka apol namuk hex values kanan patum
-->so ini terminalilek pokuka enit python il aanen thonun ee code chyuka :
```
>>0x75^'a'.ord^'c'.ord
==>119              //this is deciaml value.we nee hex
>>"%2x" % 119
==>"77"              //ipol hex kiti
```
ee 75 ennath nauk decoder il ninum hex aayi kitiya first block ile first byte aan ok
-->ee first line code onum enikarila ivan chythath athupole itt athrathane
-->so ee 77 enna value eduth aa hex ile first block ile first byte aayi replace chyuka. enit base64 il encode chythit namuk puthiya cookie kitum.ath namude cookie replace chythit send chythal namal admin aayi marum ok
-->angane lab complete aayi ok

-->==ee lab full confusion aan onum manasilakunila.so lab complete chyan patunuila.namuk kitiya hex il value 75 alla 14 ennan undayirunath.ath kozhapamila.but .ord vechula command enagne terminalil run chyanamenariyila.so avide vech stuck aayyi.==
