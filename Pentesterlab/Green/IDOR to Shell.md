
## Introduction
-->This exercise covers how to get code execution by chaining vulnerabilities in a Ruby-on-Rails application
-->This course details the exploitation of `Insecure Direct Object Reference` (IDOR).
-->Using a simple `Rails` application, we show how an attacker can use `IDOR` to gain access to the administration pages, after bypassing the `Multi-Factor Authentication` present on the application.
-->Then, using this access, the attacker will be able to gain code execution on the server.
The attack is divided into 3 steps:
1.  Find the IDOR to retrieve users' password and cracking them
2.  Bypass the Multi-Factor Authentication
3.  Gain code execution in two steps

## Insecure Direct Object Reference
-->First, you should be able to visit a users' profile.
-->From the users' profile page, you should be able to get a JSON version of the users' record, that contains the hash of the user's password.
-->By iterating on the user id, you should get a list of usernames and passwords to use with [John The Ripper](http://www.openwall.com/john/).
-->Once you crack one of the password, you should be able to log in.

## Bypassing the Multi-Factor Authentication
-->To understand how to bypass the Multi-Factor Authentication, you need to think about the MFA application as a backend service that the main application calls for all MFA related actions:
-   When the main application needs to generate an auth code and send it, it calls the backend.

-   When the main application needs to verify an auth code, it calls the backend.

-->During the verification process, the main application sends a GET request to `http://backend/verify_code/[CODE]`. With `[CODE]` being the code.
-->For example, to verify the code `1234`, the main application will access `http://backend/verify_code/1234`.
-->To check that the code is correct, the application only checks that the MFA backend returns a `HTTP 200` response.
-->And this is where the issue lies, if you can get the backend to return a `HTTP 200` response, you're in.

## Gaining code execution
-->Once you have bypassed the MFA, you will want to access the administration interface.
-->In this interface, you are able to see a list of files and download them.
-->If you upload a file, you should see that a prefix is added to the file's name, and you have only limited room to get code execution.
-->Fortunately, thanks to another IDOR, you should be able to edit the file's name and path. Using this, you can change the path of the file.
-->Now a second issue exists in the way the Ruby application serves the file.
-->Instead of using the Ruby method `File.open`, it uses the `open` method. This explanation should give you enough information to gain code execution and run the score command.

## Conclusion
-->This exercise showed you how you can chain vulnerabilities to escalate access in an application, and finally gain code execution.
-->This challenge is a good mix of several exercises you have encountered as part completing previous badges.

# Video Explanation
## Video - exploitation
-->lab open chyuka. avide admin@pentesterlab enn oru link undakum.athil click chyumbol namal ingane oru url il ethum ->http://ptl-b8b51c83-1a431ced.libcurl.so/users/1
-->avide page il :
```
### User #1

Email: admin@pentesterlab.com  
Password: **************
```
ingane undakum. so ivide password namuk kanan patila.inspect element adichalum password kanan patila. but .json enn namal 1 inte koode ittal namuk aa page inte json view kitum ie,->`http://ptl-b8b51c83-1a431ced.libcurl.so/users/1.json`
-->ipol namuk password kitunund :
```
{"id":1,"email":"admin@pentesterlab.com","password":"ea221b191de37d3548b3daa98c6d3ca4675260829273d2e22f409392d817724e","created_at":"2022-12-05T20:23:36.000Z","updated_at":"2022-12-05T20:23:36.000Z","url":"http://ptl-b8b51c83-1a431ced.libcurl.so/users/1.json"}
```
-->so ini ee password eduth athinte hash decrypt chythath google il undon nokanam.ivide search chythapol onum kanan patunila
-->ivide last 1.json enna sthalath namuk idor chyam.so 1 mati 2.json enn idumbol namuk matoru userinte password kitunund.so atheduth namal google il search chyumbol namuk password kitunund
-->so ith vech ini sign in chyam ie, `username:user@pentesterlab.com & passwd:secret123`
-->ithadich kerumbol namal direct account il alla kerunath marich mfa code koduthale namuk account il keran patu
-->ivide nerthe pole ->http://ptl-b8b51c83-1a431ced.libcurl.so/mfa  ile mfa remove chythal namuk mfa bypass chyan patila. but namuk ivide directory traverse test chyan patunon nokam
-->so ivide code kodukuna input il just `..`  koduth send adikumbol namal mfa bypass chyukayan suhrthukale. ..  enn thane idanamenil ../..  enn idumbozhum namal bypass chyunund ok
-->ipol namal account il keri ini avide new file enna oru link und.athil click chyth namuk puthiya files upload chyan patum.
-->so athil click chyth enthengilum normal txt file upload chyuka.upload chyth kazhinj namal page nokiyal kanam upload chytha file eth path aan kidakunathen applicaiton thane kanikum `/srv/files/2/introspection.txt`
-->athinte aparam show enna button und.so ath clic chythal namuk aa file dowload chyan patum
-->so ini mukalil url nokiyal kanam->http://ptl-b8b51c83-1a431ced.libcurl.so/files/3   enn.  ividem namal edit enna path test chyanam.developers chela samayangalil ithoke remove chyan maranpokum.
-->so ->http://ptl-b8b51c83-1a431ced.libcurl.so/files/3/edit   enn kodukumbol namal nerthe upload chythal file upload chyan kanaikum.athinte koode oru new input koodi undakum ie, path
-->so aa path input il namal namuk venda command idanam.NOTE : ivide applicaiton ruby aan use chyunath.so naaml command idanengil rand reethi und ariyalo.so kernal.open enno angane etho ille.so ath vech command adikanengil aadyam oru pipe | idanam ennitan command adikendath.so path ile contensts remove chythit just | uname   enna command kodukuka enit upload chyuka
-->ipol puthiya file aavila pakaram nerthe send chyhtla aa same file il thane ipol path mari kidakunath kanam athayath `| uname ` enn. so ini namal show click chythal namuk aa file download chyan patum.but ipravisham uname command aan file il ullath.
-->so ini lab complete aakan namude UUID uname enna command in pakaranm koduthal mathi ok
-->koduthal mathram pora aa file dowload chyanam.apol aa file il exercise completed enn kanikum ok