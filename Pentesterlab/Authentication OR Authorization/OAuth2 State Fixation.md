## Introduction
-->This exercise covers the exploitation of a state fixation in the OAuth2 Client
-->This course details the exploitation of an insecure OAuth2 Client that is vulnerable to a state fixation vulnerability. Coupled with a CSRF to log in with OAuth2 and to link an account, this can be exploited to take over an account. The OAuth2 Client uses OAuth2 as a pseudo-authentication mechanism, and in this challenge, you will see how you can chain these issues.
-->OAuth2 is incredibly hard to get right; that's why being able to find holes in implementations is essential.

## The vulnerability
-->This vulnerability here is that the state parameter used to prevent CSRF for the OAuth2 Client can be fixated by a user via a CSRF. The link to start the OAuth2 linking is also predictable. OAuth2 Clients should make sure that the link (or form) used to start the OAuth2 dance are not predictable. Combine with the fact that the state can be fixated; it is possible to link the victim's account to your account and then use it to gain access to the victim's account.

## Exploitation
-->To exploit this vulnerability, you will need to register a malicious account on the Authorization Server. By going through the OAuth2 dance, you will be able to inspect the state parameter.
-->One important thing to keep in mind is that the state and the code are not connected. The code is used by the Authorization Server, and the state is used by the OAuth2 Client. Therefore you can use a valid code coming from the Authorization Server with any state from the OAuth2 Client.
-->Another thing is that the state is checked by looking into the user's session. You will, therefore, need to prime the user's session to make sure there is a state in it.
-->For the payload, you will need to create an HTML page that will do two things:
-   prime the victim's session by starting the OAuth2 dance and fixating the state
-   pass the valid code with the state you fixated.
-->If the victim's account has already been linked to another account, it may be worth to CSRF-unlink the account before starting the OAuth2 dance.
-->Once you setup your webserver with the malicious page that automatically starts the OAuth2 dance and fixes the state. Then you can CSRF the last step of the OAuth2 dance with a valid code.
-->Finally, you will need to visit the OAuth2 Client and log in using OAuth2 to access the information from the victim.

## Conclusion
-->This exercise showed you how to exploit a vulnerability in an OAuth2 implementation impacting the OAuth2 Client. With more and more enterprises using OAuth2, it's crucial to ensure that this kind of mistakes gets detected and fixed before they get exploited.

# Video Explanation
## Video 1 introduction
-->The attack
- Start the OAuth2 flow in your browser
- Stop before the redirect to the OAuth2 client
- Get the victim to visit your malicious page/server
- The victim's account is linked
- Get access to the key for this exercise by logging in as the victim on the OAuth2 client via "Login with OAuth2"

## Video 2 exploitation
-->ith html script vechan exploit chyunath.athayath namal namude account il oauth2 signup chyan nokuka enit pakuthk vech ie, intercept chyth forward adikanam enit namude state kituna reqeust il nokit chyunu
-->html code njan screen shot chyth pentesterlab il ittitund nokiko
-->so aa state namal ee html file il oru img tag ile src il aakunu enit intercept il ulla request drop chyunu.ini victim vann namude malicious site ile ee page il varumbol victim inte OAuth2 account namude thil aakunu.so ini namal oauth2 sign in chyumbol namal aa victim inte account aayi marunu angane entho ok