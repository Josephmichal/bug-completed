## Introduction
-->This course details the exploitation of an insecure OAuth2 Authorization Server that allows a malicious user to trick a victim to gain access to his/her account. OAuth2 is incredibly hard to get right that's why being able to find holes in implementations is so important.

## OAuth2 101
-->OAuth2 is a protocol used to grant access to resources to a client. A typical scenario involved four parties:

-   The Resource Owner (basically the user with his/her browser).
-   The OAuth2 Client (not to be confused with the browser), that wants to get access to some resource.
-   The Authorization Server that will store all the users' account and manage authorization.
-   The Resource server that will store the actual resource that a Client wants access to.

-->The steps below highlight how a user can use OAuth2 to grant access to resources:

1.  The Resource Owner (browser) tries to access the OAuth2 Client, the OAuth2 Client gets redirected to the Authorization Server.
2.  The Resource Owner grants access to the OAuth2 Client as part of the redirect to the Authorization Server.
3.  The Resource Owner gets redirected back to the OAuth2 Client.
4.  The OAuth2 Client contacts the Authorization Server with the code provided by the OAuth2 Client.
5.  The OAuth2 Client gets a token from the Authorization Server.
6.  The OAuth2 Client uses the token to contact the Resource Server.
7.  The Resource Server passes the token to the Authorization to verify it and get information about the user
8.  The Resource Server grants access to the OAuth2 Client.

-->The trust-relationship works because the OAuth2 Client sends the token to the Resource Server and the Resource Server passes it to the Authorization Server to get information about the current user. The Resource Server does not know anything about the Resource Owner aside from a reference/unique identifier.

## Inspecting the HTTP traffic
-->If we look at the HTTP traffic, we can see the following requests and responses:
-->First, the User-Agent visits the OAuth2 Client and click on "Sign-in with OAuth" to get redirected to the Authorization Server. As part of the redirect, the OAuth2 Client adds the following parameters:

-   The client_id to tell the Authorization Server who the OAuth2 Client is.
-   The redirect_uri to tell the Authorization Server where the Resource Owner (the browser) should be redirected to.
-   The response_type to tell what type of response the OAuth2 Client wants
-   A state parameter to prevent CSRF against the OAuth2 Client (more on this in future exercises).

-->Once the Resource Owner is redirected to the Authorization Server, the Resource Owner can allow the OAuth2 Client to access the resources the OAuth2 Client asked for (assuming the Resource Owner is logged in). The Resource Owner gets redirected to the redirect_uri value, as part of the redirect, the Authorization Server adds the following parameters:

-   The code parameter that will allow the OAuth2 Client to get a token
-   The state parameter to prevent CSRF against the OAuth2 Client.

-->once the Resource Owner is redirected to the OAuth2 Client, the OAuth2 Client can consume the code to get an access_token by using the client_id and client_secret by contacting the Authorization Server directly (backchannel).

## The attack
-->One of the issues with OAuth2 can be found when the Authorization Server does not enforce the redirect URL. The redirect URL should be set and enforce for each OAuth2 Client (based on the client_id parameter). After the victim/Resource Owner authorizes the application (which will be done automatically once it has already been authorized), the victim will be redirected to the redirect URL with the code as part of the URL.
-->If an attacker can trick a victim into visiting a link to the Authorization Server with a malicious Redirect URL pointing to a server under the attacker's control, the attacker can get access to the OAuth2 code and pass the code to the OAuth2 Client to pretend the access was granted as the victim (as if it was the victim visiting the OAuth2 Client).

-->The attacker needs to follow these steps:

-   Start the OAuth2 "Dance" and intercept the request going to the Authorization using HTTP GET.
-   Setup a server where the attacker can access the logs.
-   Swap the redirect URL parameter with the attacker's server.
-   Get the victim to visit this URL.
-   Use the request coming from the victim to finish the OAuth2 "Dance" with the OAuth2 Client (using the same session to keep the valid state).

-->By doing that, the attacker should have access to the resources via the OAuth2 Client. The resources contain the key and should be visible in the OAuth2 Client's page.

## Conclusion
-->This exercise showed you how to exploit a vulnerability in an OAuth2 implementation impacting the Authorization Server. With more and more enterprises using OAuth2, it's important to ensure that this kind of mistakes gets detected and fixed before they get exploited.

# Video Explanation
## Video 1 - OAuth2 101
-->OAuth2 flows :
- Authorization Code Grant
- Implicit Grant
- Client Credential Grand
- Password Grant

-->ithile first 2 grands aan baki ullathinekalum secure. ee grands ine pati namal portswigger il padichitund
-->When implementing OAuth2 we need to be careful
- OAuth2 is extremely complex and a lot can go wrong
- A lot of checks need to be in place and correctly implemented to ensure the security of the implementation
- Often even small mistakes can lead to catastrophic consequences(like data leak, account takeover..)

## Video 2 introduction
-->The attack :
- Start the oauth2 flow in your browser
- Tamper with the redirect_uri to point to your server
- Get the victim to visit your the link with your redirect_uri
- Get the code
- Continue the oath2 flow by passing the code and original state to the oauth2 client
- Get access to the key for this exercise

## Video 3 exploitation
-->lab open chyuka enit signup il poi oru account undakuka.enit sign in with oauth clic chyuka apol namuk oru link kitum :
->http://authorization-ptl-14bce025-ea1fc156.libcurl.so/oauth/authorize?client_id=ed8dcb27c5dd3627375996a8cffdb97df35cfe770ccab11077bc94b140771b2f&redirect_uri=http%3A%2F%2Fptl-14bce025-ea1fc156.libcurl.so%2Fauth%2Fmyprovider%2Fcallback&response_type=code&state=544a2117c9a4d247c21c66c88335b3e500af5956b32943d1
-->ee link il redirect_uril paramter il ulla `ptl-14bce025-ea1fc156.libcurl.so`  mati namal control chyuna webserver kodukanam.enit namal ee new url eduth lab il paste chyth submit adikanam ini terminalil poi nokiyal kanam victim aa path ile poyitund
-->so victim namude ee malidous path il pokumbol terminalil victim use chyuna full url um namuk kitum. aa url il code= undakum
-->so ee code eduth namude url il koduth send chyumbol namuk victim aayi maran patum
-->NOTE : state ennath oru csrf pole aan ath oauth2 client in vendi use chyunathanen thonunu.ith oru pravishame use chyan patum. use chyth kazhinjal pinem use chyan patila.so namal test chyumbol ee state= paramter use chyand chyanam ok