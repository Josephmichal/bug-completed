## Introduction
-->This exercise covers the exploitation of a service provider (SP) that doesn't check the certificate provided in the SAMLResponse
-->This course details the exploitation of an insecure SAML implementation that allows a malicious user to become another user. The issue comes from the fact that the Service Provider (SP) does not check the fingerprint of the certificate provided in the SAMLResponse to make sure the certificate is trusted.

## The attack
-->Since the Service Provider does not check the certificate's fingerprint when verifying the SAMLResponse, attackers can provide their own certificate with a matching signature, and the application will trust the signature.
-->To exploit this issue, you will need to:
-   Register an account on the IDP.
-   Generate a private key and the matching certificate.
-   Forge a SAMLResponse based on the SAMLRequest provided by the SP.

## Exploitation
-->To perform this attack, you can use one of the following strategies:
-   Build your own SAMLResponse based on the SAMLResponse provided by the IDP (by tampering the data and resigning the message). This is probably the most complex way to do it as you will need to precisely understand how the signature is created.
-   Build your own IDP that uses your private key (and certificate) and pass the SAMLRequest from the Service Provider to your malicious server to get the SAMLResponse that you can then pass to the Service Provider.
-   Build or use a script that leverages a SAML library to build the SAMLResponse for you based on the SAMLRequest form the Service Provider and your private key and certificate.

## Conclusion
-->This exercise showed you how to forge a valid assertion if the Service Provider does not check that the certificate provided is trusted. With more and more enterprises using SSO, it is essential to ensure that this kind of mistakes gets detected and fixed before they get exploited.

# Video Explanation
## Video 1 introduction
-->namuk ariyam saml response private key vech sign chythan namuk response tharunath. so athil signature um unakum athupole X509 certificate um undakum. ee certificate ilum private key inte karyangal undakum
-->Some implementation may trust the certificate embedded within the SAML response and use the associated public key to verify the signature
-->This allows an attacker to provide their own certificate and sign the message with thier own private key.so application response retireve chyumbol certificate il ulla private key attacker inte aan but ignore chyila
-->The attack :
- Generate a private key and a certificate
- Intercept and tamper with the saml response to change username
- Resign the SAML response

## Video 2 exploitation
-->lab open chyuka enit oru account undakuka enit go to the service provider click chyuka enitlogin with saml click chyuka enit ath intercept chayanam
-->enit burp il saml resopnse nokanam :
```
<samlp:Response ID="_6b57c980-5c46-013b-2518-0242ac10005c" Version="2.0" IssueInstant="2022-12-12T12:28:34Z" Destination="http://ptl-b6c84c86-21a4cb42.libcurl.so:80/saml/consume" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_e71017db-e89f-4f02-843e-cd70e0f2ff30" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"><Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://idp-ptl-b6c84c86-21a4cb42.libcurl.so/saml/auth</Issuer><samlp:Status><samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/></samlp:Status><Assertion xmlns="urn:oasis:names:tc:SAML:2.0:assertion" ID="_6b57cc50-5c46-013b-2518-0242ac10005c" IssueInstant="2022-12-12T12:28:34Z" Version="2.0"><Issuer>http://idp-ptl-b6c84c86-21a4cb42.libcurl.so/saml/auth</Issuer><ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"><ds:SignedInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"><ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"></ds:SignatureMethod><ds:Reference URI="#_6b57cc50-5c46-013b-2518-0242ac10005c"><ds:Transforms><ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"></ds:Transform><ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"></ds:DigestMethod><ds:DigestValue>8uMJeYl65hB9vABpyKuJvSOTB+Xu8G2Vlez8aQxsVqQ=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>UTcKuaRG7KRSh9x9kI2UZD7bQTlkqfKN6s9tU6MEkxdDHuHp7XkEd3kX3gvB0wuRtjpvDKHqabA3laETS5TGZstRUuCZTXK9jyBvIVuO7M/AcVe+QMBfoIqh/rtwBR8pigIRSgc06rSMuqNz9btiwb1dFyK40LemTE3i3EIWx0Xi3OMVErB4Xdo+IWKYPYXPROVPDNPJF+h53V9SdZiJrLA9yTbHBWZSe26ywci6eaA9JyMYkz3llUzkp88aFNNZt+ev08NL3nVDY7ocO2eMwTGbghgAlqmxcAUXMk6wVbXafTKGTTAzMbJ+WNVQ77uQ6MRisg6eGc8Vy2AlX+XyNiMy+ifRIN+jtwk0nZlInbpYu9R3N3/FNGFTib1kms4L37cSb74Sb/PS5Hs8SwdF3autGYQ6auMCd4L0q4eApkCHUB7yKgoL+pmcES7Oxaxx6atjnI21l53+QQc0cius8u29dFeUVG+8DWuQvXQ9eHAqJGBjPaNrsvULGX/mR3zglON+arteumZl60FVKF2KfMjyGrIwb/LWtytmEvCAK7VcD7HNbBLSdsGY/cUsLyyby6c1QZXD+cORz1Ca8V9O3yoL8lxguVVV430/FwPK3ekAT1A3macrXph+21xmAkyc23igoPX0REaxt1qg3LRh6QUdWb3S8Ut7N3N3IUIZf0o=</ds:SignatureValue><KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"><ds:X509Data><ds:X509Certificate>MIIFNjCCAx4CCQCTSqRC77MmzDANBgkqhkiG9w0BAQsFADBdMQswCQYDVQQGEwJBVTERMA8GA1UECAwIVmljdG9yaWExEjAQBgNVBAcMCU1lbGJvdXJuZTEVMBMGA1UECgwMUGVudGVzdGVyTGFiMRAwDgYDVQQDDAdzYW1sX2lpMB4XDTIwMDYwNDAxNTMwNloXDTIzMDMwMTAxNTMwNlowXTELMAkGA1UEBhMCQVUxETAPBgNVBAgMCFZpY3RvcmlhMRIwEAYDVQQHDAlNZWxib3VybmUxFTATBgNVBAoMDFBlbnRlc3RlckxhYjEQMA4GA1UEAwwHc2FtbF9paTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBANkFMY2Q98897+XD4T1YW+O1dTl2GSMS8Nktdsolqw+GLin6V0Pn0kFmaq2e9rwIXfcBe9et3VrOHXt0O6dEUhxLGn0c68rtiWTd0lp6vJVACrvBeoXQgPSKPu49XcwJozDhpzILwOR/tR6Uzl+rQVjWBcKh2uyCLPoDNy/bqB4Q3mV4YaXV5mfTibjqNNvRyakAVYkjnw9P4CCmtIVJgVIMzTXHLdlFYDGVq102mqbDs5RTbg5qPva1h8F1QIyJ2HuKbjvC1Ok7NjITTTXGArNPrMQYRLCrx8QNhcXGtY/tK4iaZeqHqij42gWiVspy781pJYSJ4xoRdmocdk+6sxr8xcNGF1S+HsWFFaK/dIaY8eaPpbYb3viS8sLqNW7P43ZpEtUV9pLtafCTUVIMT38g1SFMU+zGDvJbXU9kzZccDOjkcvsYqD8vSt1CqLU9m4S0iw22xdVLMD7VL0FU4C7Gf2j/yw/2Jrz8rBiyDRau7xQdkqOscfieWcgjq1FBFrY5xE+nwO7/0DWZSQOR2jYkSoYMOXlaYTV/Ql1PJCKDrQGD2/kHBcgzehsNRmedLNFU0KJ7DxM7eGdYCuO4SciZ9RNsKLOnjpLPnAyMrkxVM9c1S+NJ0FBVsbrqfTJe43/Mkm5WjH+XesU1zBD7iRlVdDA1+iS8DHV7CYrSqCQDAgMBAAEwDQYJKoZIhvcNAQELBQADggIBALOiJFiJJqRo26IHntFvapn+/ZBrEtXoQ6G/xVCrwvT9R2dkcgXScT5L+NoW5e0Vu5Jqj/X7n+QAlkSzzXsvwC8i2dXnh3ARaca49WPf9al8aCxam2/ku8kTzcFYwq3TJHXu28GLVi6FAc7advzUGfS0YToudO3JzggtEA51KpwtzdP5r+m2pLRYrjyFONh1v71vjOi0XUhtC2gcoxTjnpESBMExN1/L/ZnWL8FtwaWTgIhn5EL+GOwldHVWbzF5UgAlgrolJwCe/YitZ3wcgze52CBOTRwcbCX94boNjLFA4wZAutGqcg1IZhV5ehCiEUklT1FfhNYukoTvUQFBGaB1RdZLJBYJYaQ4GdDQ7S4qnX6NZCIpDIaInmZz8j9kb2Fb3Ve7qDk2aVV0htaqlEtiJ7oV2IRvA5Oppkyf30haVlN759iSkPjuJTXtdyMOdxjWNjneFaWPNjAyHw/I3Ov+iWWNpX/tqWebnFAKyEhS5V11kSuo+j60BGUW1oj6Sk9i45ffsZVKvLZX84ACntRK3XBsO7yvStDzOteEvz5lzspxbcYz+Vo7tcWXuGab3TJlpEhiJon1F+1hMEryKI8NVoH/8Q0npzWArScKhUMEBLKURzhC3HvECDB5kpA2zsmJEB+S8JVZAEr0tDpjTAx2DfpCVKosFfQsBEU3fvB6</ds:X509Certificate></ds:X509Data></KeyInfo></ds:Signature><Subject><NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">josu@josu.com</NameID><SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"><SubjectConfirmationData InResponseTo="_e71017db-e89f-4f02-843e-cd70e0f2ff30" NotOnOrAfter="2022-12-12T12:31:34Z" Recipient="http://ptl-b6c84c86-21a4cb42.libcurl.so:80/saml/consume"></SubjectConfirmationData></SubjectConfirmation></Subject><Conditions NotBefore="2022-12-12T12:28:29Z" NotOnOrAfter="2022-12-12T13:28:34Z"><AudienceRestriction><Audience>http://ptl-b6c84c86-21a4cb42.libcurl.so:80/saml/auth</Audience></AudienceRestriction></Conditions><AuthnStatement AuthnInstant="2022-12-12T12:28:34Z" SessionIndex="_6b57cc50-5c46-013b-2518-0242ac10005c"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>
```
-->ivide namuk search chyth nokanam x509 enn apol namuk certificate value kidakunath kanan patum. mukalil und nokiko
-->ini enth venamenal ee saml response il ulla certificate application trust chyunundon ariyanam
-->ini namuk puthiya oru private key undakum :
->`openssl req -nodes -new -x509 -keyout key.pem -out cert.pem`  ipol namuk private key aakum .but chela details koodi kodukanam it, ee step il kodutha mathi -> AU , VIctoria , Melbourne , Pentesterlab ,  , saml_v.pentesterlab.com,  ,

-->ipol namuk cert.pem file um aayi athupole key.pem file um aayi
-->ini burp il poi saml raider tab il poi import click chyth ee cert.pem file add chyuka
-->ini traditional RSA pem button click chyth key.pem fileum add chyuka.ee key.pem file aan private key.pakshe ingane chyumbol key=false mari true aakila .so enth venamenal namude key.pem file onn sheriyakan und so ->openssl rsa -in key.pem   koduthal sheriyakum.ini onukoodi upload chythal true aayikolum
-->ini thirich namude intercept chytha saml response il pokuka enit josu@josu.com enna username mati admin@libcurl.so koduth resign assertion click chyth send chythal namal admin aayikolum ok